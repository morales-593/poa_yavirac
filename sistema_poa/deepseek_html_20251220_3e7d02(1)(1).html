<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Planificación Operativa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --secondary-light: #34495e;
            --success: #2ecc71;
            --success-dark: #27ae60;
            --danger: #e74c3c;
            --danger-dark: #c0392b;
            --warning: #f39c12;
            --warning-dark: #d35400;
            --info: #1abc9c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --text: #333;
            --text-light: #7f8c8d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--secondary) 0%, var(--secondary-light) 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 3px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
            position: relative;
            height: 100vh;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sidebar-header h2 {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .close-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: none;
        }
        
        .sidebar-menu {
            padding: 20px 0;
            height: calc(100vh - 80px);
            overflow-y: auto;
        }
        
        .sidebar-menu ul {
            list-style: none;
        }
        
        .sidebar-menu li {
            padding: 15px 25px;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            align-items: center;
            border-left: 4px solid transparent;
        }
        
        .sidebar-menu li i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            font-size: 18px;
        }
        
        .sidebar-menu li:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .sidebar-menu li.active {
            background: rgba(52, 152, 219, 0.2);
            border-left: 4px solid var(--primary);
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            width: calc(100% - 280px);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .menu-toggle {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .logout-btn {
            background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        .logout-btn i {
            margin-right: 8px;
        }
        
        /* Card Styles */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            padding: 18px 25px;
            background: linear-gradient(90deg, var(--light) 0%, #f8f9fa 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--secondary);
        }
        
        .card-body {
            padding: 25px;
        }
        
        /* Table Styles */
        .table-responsive {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: rgba(52, 152, 219, 0.03);
        }
        
        /* Button Styles */
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            transition: all 0.3s;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .btn-xs {
            padding: 6px 10px;
            font-size: 12px;
            margin: 2px;
        }
        
        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-complete {
            background: var(--success);
            color: white;
        }
        
        .status-incomplete {
            background: var(--danger);
            color: white;
        }
        
        .status-pending {
            background: var(--gray);
            color: white;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.4s;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--primary);
            color: white;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            color: white;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-footer {
            padding: 18px 25px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Custom Select Styles */
        .custom-select {
            position: relative;
            width: 100%;
        }
        
        .custom-select select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .custom-select select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .custom-select::after {
            content: '\f078';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--primary);
        }
        
        /* Form Row Styles */
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        /* Elaboracion Form Styles */
        .elaboracion-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .elaboracion-title {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--secondary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }
        
        .item-titulo {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            padding: 10px;
            background-color: #e8f4fc;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
        }
        
        .medio-verificacion-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .medio-verificacion-table th,
        .medio-verificacion-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        .medio-verificacion-table th {
            background: var(--primary);
            color: white;
        }
        
        .medio-verificacion-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .medio-verificacion-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
            gap: 10px;
        }
        
        /* File Upload Styles */
        .file-upload-container {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s;
            background: #f9f9f9;
        }
        
        .file-upload-container:hover {
            border-color: var(--primary);
            background: #f0f8ff;
        }
        
        .file-upload-container.dragover {
            border-color: var(--success);
            background: #f0fff0;
        }
        
        .file-upload-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .file-upload-text {
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-list {
            margin-top: 20px;
            text-align: left;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .file-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-icon {
            color: var(--danger);
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Login Styles */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 20px;
        }
        
        .login-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 420px;
            max-width: 90%;
            padding: 35px;
            text-align: center;
        }
        
        .login-title {
            margin-bottom: 30px;
            color: var(--secondary);
            font-size: 28px;
            font-weight: 700;
        }
        
        .login-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            margin: 0 auto 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .login-btn {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }
        
        /* Card Grid for Coordination */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .user-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 20px;
            position: relative;
            transition: all 0.3s;
            border-left: 5px solid var(--primary);
        }
        
        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .user-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .user-name {
            font-weight: 700;
            font-size: 18px;
            color: var(--secondary);
        }
        
        .user-actions {
            display: flex;
            gap: 8px;
        }
        
        .user-details {
            color: var(--gray);
            font-size: 14px;
        }
        
        /* Alert Styles */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
            width: 350px;
            max-width: 90%;
            animation: slideInRight 0.5s, slideOutRight 0.5s 4.5s forwards;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .alert-success {
            background: rgba(46, 204, 113, 0.95);
            color: white;
            border-left: 4px solid var(--success-dark);
        }
        
        .alert-danger {
            background: rgba(231, 76, 60, 0.95);
            color: white;
            border-left: 4px solid var(--danger-dark);
        }
        
        .alert-warning {
            background: rgba(243, 156, 18, 0.95);
            color: white;
            border-left: 4px solid var(--warning-dark);
        }
        
        .alert-info {
            background: rgba(52, 152, 219, 0.95);
            color: white;
            border-left: 4px solid var(--primary-dark);
        }
        
        .alert i {
            margin-right: 12px;
            font-size: 22px;
        }
        
        /* Check Styles for Plan Operativo */
        .check-status {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .check-icon {
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .check-icon:hover {
            transform: scale(1.2);
        }
        
        .check-complete {
            color: var(--success);
        }
        
        .check-incomplete {
            color: var(--danger);
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        /* ========== ESTILOS PARA PAGINACIÓN Y BÚSQUEDA ========== */
        .search-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            max-width: 400px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 15px;
            padding-left: 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2395a5a6' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 15px center;
            background-size: 16px;
        }
        
        .search-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .pagination-info {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .pagination {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 40px;
            text-align: center;
        }
        
        .page-btn:hover:not(.disabled) {
            background: #f8f9fa;
        }
        
        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-numbers {
            display: flex;
            gap: 5px;
        }
        
        .records-per-page {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .records-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                position: fixed;
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .close-sidebar {
                display: block;
            }
            
            .menu-toggle {
                display: flex;
            }
            
            .main-content {
                width: 100%;
                margin-left: 0;
            }
            
            .card-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
            
            .action-buttons {
                justify-content: center;
            }
            
            .alert {
                width: 90%;
                right: 5%;
                left: 5%;
            }
            
            .search-container {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .pagination-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .pagination {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
        
        /* Animation for page transitions */
        .page-content {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Overlay for mobile menu */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
            display: none;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
        
        /* Estilos para el campo de eje deshabilitado */
        .eje-disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
            color: #666;
        }
        
        .eje-disabled-label {
            color: #666;
        }
        
        .info-text {
            font-size: 12px;
            color: #3498db;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* Estilos para campos de solo lectura */
        .read-only-field {
            background-color: #f9f9f9;
            cursor: not-allowed;
            color: #666;
        }
        
        /* Estilos para el modal de seguimiento */
        .seguimiento-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .seguimiento-title {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--secondary);
            border-bottom: 2px solid var(--warning);
            padding-bottom: 10px;
        }
        
        /* Estilos para el estado de cumplimiento */
        .cumplimiento-select {
            min-width: 120px;
        }
        
        .cumplimiento-si {
            background-color: #d4edda;
            color: #155724;
        }
        
        .cumplimiento-no {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* Estilos para campos de fecha */
        .fecha-field {
            max-width: 200px;
        }
        
        /* Estilos para validación */
        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .form-control.error {
            border-color: #e74c3c;
        }
        
        .save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Estilos para estado de plan */
        .plan-status {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-completado {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-pendiente {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-incompleto {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* Estilos para inputs numéricos especiales */
        .indicador-input {
            font-family: 'Courier New', monospace;
        }
        
        .porcentaje-input {
            text-align: right;
        }
        
        /* Estilos para columnas específicas de la tabla */
        .elaboracion-col {
            min-width: 120px;
        }
        
        .seguimiento-col {
            min-width: 120px;
        }
        
        .ejecucion-col {
            min-width: 120px;
        }
        
        .acciones-col {
            min-width: 100px;
        }
        
        /* Estilos para botones en columnas */
        .col-button {
            width: 100%;
            margin-bottom: 5px;
        }
        
        /* NUEVOS ESTILOS para check de botones */
        .button-with-check {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .check-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--success);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1;
        }
        
        /* Estilos mejorados para la columna de estado */
        .estado-detalle {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .estado-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .estado-icon {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            color: white;
        }
        
        .estado-completado {
            background-color: var(--success);
        }
        
        .estado-pendiente {
            background-color: var(--warning);
        }
        
        .estado-incompleto {
            background-color: var(--danger);
        }
        
        /* Estilos para botones con estado */
        .btn-with-state {
            position: relative;
            padding-left: 35px;
        }
        
        .btn-state-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        /* ========== NUEVOS ESTILOS PARA DASHBOARD ========== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
            border-top: 4px solid var(--primary);
            height: 180px;
            justify-content: space-between;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .stat-card.warning {
            border-top-color: var(--warning);
        }
        
        .stat-card.success {
            border-top-color: var(--success);
        }
        
        .stat-card.info {
            border-top-color: var(--info);
        }
        
        .stat-card.danger {
            border-top-color: var(--danger);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
            color: white;
        }
        
        .stat-icon.primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }
        
        .stat-icon.warning {
            background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
        }
        
        .stat-icon.success {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
        }
        
        .stat-icon.info {
            background: linear-gradient(135deg, var(--info) 0%, #16a085 100%);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--secondary);
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 10px;
        }
        
        .stat-change {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-change.positive {
            color: var(--success);
        }
        
        .stat-change.negative {
            color: var(--danger);
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--secondary);
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .simple-bar {
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .simple-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .stats-table th {
            background: var(--secondary);
            color: white;
            font-weight: 600;
            padding: 12px 15px;
            text-align: left;
        }
        
        .stats-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .stats-table tr:hover {
            background: rgba(52, 152, 219, 0.03);
        }
        
        .stats-table .highlight {
            background-color: #e8f4fc;
            font-weight: 600;
        }
        
        .percentage-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            background-color: #e8f4fc;
            color: var(--primary);
        }
        
        .dashboard-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            background: #f8f9fa;
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--gray);
            font-size: 16px;
        }
        
        .no-data i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        /* ========== ESTILOS PARA GRÁFICOS MEJORADOS ========== */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            height: 400px;
            display: flex;
            flex-direction: column;
        }
        
        .chart-wrapper {
            flex: 1;
            position: relative;
        }
        
        .line-chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-top: 20px;
        }
        
        .chart-canvas {
            width: 100% !important;
            height: 100% !important;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        /* ========== ESTILOS PARA INDICADORES PREDEFINIDOS ========== */
        .indicador-predeterminado {
            background-color: #f0f8ff;
            border: 1px solid #d1e7ff;
            border-radius: 6px;
            padding: 8px 12px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .indicador-predeterminado:hover {
            background-color: #e1f0ff;
            transform: translateX(5px);
        }
        
        .indicador-predeterminado.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary-dark);
        }
        
        .indicadores-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        /* ========== NUEVOS ESTILOS PARA GESTIÓN DE INDICADORES ========== */
        .tabs-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab-btn:hover {
            color: var(--primary);
        }
        
        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .indicadores-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        
        .indicador-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .indicador-item:last-child {
            border-bottom: none;
        }
        
        .indicador-codigo {
            font-weight: 600;
            font-family: 'Courier New', monospace;
            color: var(--primary);
        }
        
        .indicador-descripcion {
            flex: 1;
            margin-left: 15px;
            font-size: 14px;
        }
        
        .indicador-actions {
            display: flex;
            gap: 8px;
        }
        
        /* ========== ESTILOS PARA IMPRESIÓN ========== */
        .print-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--success);
        }
        
        .print-preview {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Times New Roman', serif;
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
        }
        
        .print-header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .print-field {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .print-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .print-value {
            margin-left: 20px;
        }
        
        .firma-section {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
        }
        
        .firma {
            text-align: center;
            width: 45%;
        }
        
        .linea-firma {
            border-top: 1px solid #000;
            margin-top: 50px;
            padding-top: 10px;
        }
        
        .firma-nombre {
            font-weight: bold;
        }
        
        .firma-cargo {
            font-size: 12px;
            color: #666;
        }
        
        /* ========== ESTILOS PARA ANÁLISIS DETALLADO ========== */
        .analisis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .analisis-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }
        
        .analisis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .analisis-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 8px;
        }
        
        .analisis-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .analisis-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .analisis-item:last-child {
            border-bottom: none;
        }
        
        .analisis-label {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .analisis-value {
            font-weight: 600;
            color: var(--secondary);
        }
        
        .analisis-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 15px;
                height: auto;
            }
            
            .stat-value {
                font-size: 28px;
            }
            
            .dashboard-filter {
                flex-direction: column;
            }
            
            .filter-btn {
                width: 100%;
                text-align: center;
            }
            
            .indicadores-container {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .line-chart-container {
                height: 250px;
            }
            
            .tabs-container {
                flex-direction: column;
            }
            
            .tab-btn {
                text-align: left;
                border-bottom: 1px solid #ddd;
                border-left: 3px solid transparent;
            }
            
            .tab-btn.active {
                border-left-color: var(--primary);
            }
            
            .firma-section {
                flex-direction: column;
                gap: 30px;
            }
            
            .firma {
                width: 100%;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .chart-card {
                height: 350px;
            }
            
            .analisis-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <h1 class="login-title">Sistema de Planificación</h1>
            <div class="form-group">
                <label class="form-label">Usuario</label>
                <input type="text" id="username" class="form-control" placeholder="Ingrese su usuario" value="admin">
            </div>
            <div class="form-group">
                <label class="form-label">Contraseña</label>
                <input type="password" id="password" class="form-control" placeholder="Ingrese su contraseña" value="admin123">
            </div>
            <button id="loginBtn" class="login-btn">Comenzar!</button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="container" style="display: none;">
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Sistema POA</h2>
                <button class="close-sidebar" id="closeSidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <ul>
                    <li class="active" data-page="coordinacion"><i class="fas fa-users"></i> Coordinación</li>
                    <li data-page="plan-operativo"><i class="fas fa-clipboard-list"></i> Plan Operativo</li>
                    <li data-page="dashboard"><i class="fas fa-chart-bar"></i> Dashboard</li>
                    <li data-page="tema-poa"><i class="fas fa-folder"></i> Tema POA</li>
                    <li data-page="eje-objetivo"><i class="fas fa-bullseye"></i> Eje y Objetivo</li>
                    <li data-page="indicadores"><i class="fas fa-chart-line"></i> Indicadores</li>
                    <li data-page="plazo"><i class="fas fa-calendar-alt"></i> Plazo</li>
                    <li data-page="responsable"><i class="fas fa-user-tie"></i> Responsable de Área</li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div class="header">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title" id="pageTitle">Coordinación</h1>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <span id="currentUser">Administrador</span>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                    </button>
                </div>
            </div>

            <!-- Coordination Page -->
            <div id="coordinacion" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Usuarios del Sistema</h3>
                        <button class="btn btn-primary" id="addUserBtn">
                            <i class="fas fa-plus"></i> Crear Usuario
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Buscador y paginación -->
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="searchUsers" class="search-input" placeholder="Buscar usuarios...">
                            </div>
                            <div class="records-per-page">
                                <span>Mostrar:</span>
                                <select id="usersPerPage" class="records-select">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="card-grid" id="usersGrid">
                            <!-- User cards will be dynamically added here -->
                        </div>
                        
                        <!-- Paginación -->
                        <div class="pagination-container" id="usersPagination">
                            <div class="pagination-info" id="usersInfo"></div>
                            <div class="pagination" id="usersPaginationControls"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plan Operativo Page -->
            <div id="plan-operativo" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Plan Operativo</h3>
                        <button class="btn btn-primary" id="addPlanBtn">
                            <i class="fas fa-plus"></i> Crear Plan
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Buscador y paginación -->
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="searchPlans" class="search-input" placeholder="Buscar planes...">
                            </div>
                            <div class="records-per-page">
                                <span>Mostrar:</span>
                                <select id="plansPerPage" class="records-select">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table id="planTable">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Nombre Elaborado</th>
                                        <th>Nombre Responsable</th>
                                        <th>Estado</th>
                                        <th class="elaboracion-col">Elaboración</th>
                                        <th class="seguimiento-col">Seguimiento</th>
                                        <th class="ejecucion-col">Ejecución</th>
                                        <th class="acciones-col">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="planTableBody">
                                    <!-- Plan rows will be dynamically added here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Paginación -->
                        <div class="pagination-container" id="plansPagination">
                            <div class="pagination-info" id="plansInfo"></div>
                            <div class="pagination" id="plansPaginationControls"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page - MEJORADO CON NUEVOS GRÁFICOS -->
            <div id="dashboard" class="page-content" style="display: none;">
                <div class="dashboard-grid">
                    <!-- Estadísticas generales -->
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-value" id="totalPlanes">0</div>
                        <div class="stat-label">Total de Planes</div>
                        <div class="stat-change positive" id="planesChange">
                            <i class="fas fa-arrow-up"></i> <span>0%</span> desde el mes pasado
                        </div>
                    </div>
                    
                    <div class="stat-card warning">
                        <div class="stat-icon warning">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="usuariosActivos">0</div>
                        <div class="stat-label">Usuarios Activos</div>
                        <div class="stat-change positive" id="usuariosChange">
                            <i class="fas fa-arrow-up"></i> <span>0%</span> desde el mes pasado
                        </div>
                    </div>
                    
                    <div class="stat-card success">
                        <div class="stat-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-value" id="planesCompletados">0</div>
                        <div class="stat-label">Planes Completados</div>
                        <div class="stat-change positive" id="completadosChange">
                            <i class="fas fa-arrow-up"></i> <span>0%</span> desde el mes pasado
                        </div>
                    </div>
                    
                    <div class="stat-card info">
                        <div class="stat-icon info">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <div class="stat-value" id="ejesUtilizados">0</div>
                        <div class="stat-label">Ejes Utilizados</div>
                        <div class="stat-change positive" id="ejesChange">
                            <i class="fas fa-arrow-up"></i> <span>0%</span> desde el mes pasado
                        </div>
                    </div>
                </div>
                
                <!-- Filtros de dashboard -->
                <div class="dashboard-filter">
                    <button class="filter-btn active" data-filter="all">Todos los Ejes</button>
                    <button class="filter-btn" data-filter="eje1">Eje 1: Docencia</button>
                    <button class="filter-btn" data-filter="eje2">Eje 2: Investigación</button>
                    <button class="filter-btn" data-filter="eje3">Eje 3: Vinculación</button>
                    <button class="filter-btn" data-filter="eje4">Eje 4: Gestión</button>
                    <button class="filter-btn" data-filter="eje5">Eje 5: Internacionalización</button>
                </div>
                
                <!-- Nuevo diseño de gráficos -->
                <div class="charts-container">
                    <!-- Gráfico de barras para uso de ejes -->
                    <div class="chart-card">
                        <h3 class="chart-title">Uso de Ejes por Planes</h3>
                        <div class="chart-wrapper">
                            <canvas id="barChart"></canvas>
                        </div>
                        <div id="barChartLegend" class="chart-legend"></div>
                    </div>
                    
                    <!-- Gráfico de líneas para progreso mensual -->
                    <div class="chart-card">
                        <h3 class="chart-title">Progreso Mensual de Elaboraciones</h3>
                        <div class="chart-wrapper">
                            <canvas id="lineChart"></canvas>
                        </div>
                        <div id="lineChartLegend" class="chart-legend"></div>
                    </div>
                </div>
                
                <!-- Análisis detallado -->
                <div class="analisis-grid">
                    <div class="analisis-card">
                        <h3 class="analisis-title">Estado de Planes por Eje</h3>
                        <ul class="analisis-list" id="estadoEjesList">
                            <!-- Se llenará dinámicamente -->
                        </ul>
                    </div>
                    
                    <div class="analisis-card">
                        <h3 class="analisis-title">Eficiencia por Responsable</h3>
                        <ul class="analisis-list" id="eficienciaResponsablesList">
                            <!-- Se llenará dinámicamente -->
                        </ul>
                    </div>
                    
                    <div class="analisis-card">
                        <h3 class="analisis-title">Distribución de Planes</h3>
                        <ul class="analisis-list" id="distribucionPlanesList">
                            <!-- Se llenará dinámicamente -->
                        </ul>
                    </div>
                </div>
                
                <!-- Tabla de estadísticas de uso de ejes -->
                <div class="chart-container">
                    <h3 class="chart-title">Estadísticas Detalladas de Ejes</h3>
                    <div class="table-responsive">
                        <table class="stats-table" id="statsTable">
                            <thead>
                                <tr>
                                    <th>Eje</th>
                                    <th>Indicadores Disponibles</th>
                                    <th>Usuarios que lo Usan</th>
                                    <th>Total Planes</th>
                                    <th>% Uso</th>
                                    <th>Indicadores Utilizados</th>
                                </tr>
                            </thead>
                            <tbody id="statsTableBody">
                                <!-- Las filas de estadísticas se agregarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Tabla de indicadores más utilizados -->
                <div class="chart-container">
                    <h3 class="chart-title">Indicadores Más Utilizados</h3>
                    <div class="table-responsive">
                        <table class="stats-table" id="indicadoresTable">
                            <thead>
                                <tr>
                                    <th>Indicador</th>
                                    <th>Eje</th>
                                    <th>Descripción</th>
                                    <th>Veces Utilizado</th>
                                    <th>% Uso</th>
                                </tr>
                            </thead>
                            <tbody id="indicadoresTableBody">
                                <!-- Las filas de indicadores se agregarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tema POA Page -->
            <div id="tema-poa" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Tema POA</h3>
                        <button class="btn btn-primary" id="addTemaBtn">
                            <i class="fas fa-plus"></i> Crear Tema
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Buscador y paginación -->
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="searchTemas" class="search-input" placeholder="Buscar temas...">
                            </div>
                            <div class="records-per-page">
                                <span>Mostrar:</span>
                                <select id="temasPerPage" class="records-select">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table id="temaTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre del Tema</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="temaTableBody">
                                    <!-- Tema rows will be dynamically added here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Paginación -->
                        <div class="pagination-container" id="temasPagination">
                            <div class="pagination-info" id="temasInfo"></div>
                            <div class="pagination" id="temasPaginationControls"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Eje y Objetivo Page -->
            <div id="eje-objetivo" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Eje y Objetivo</h3>
                        <button class="btn btn-primary" id="addEjeBtn">
                            <i class="fas fa-plus"></i> Crear Eje
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Buscador y paginación -->
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="searchEjes" class="search-input" placeholder="Buscar ejes...">
                            </div>
                            <div class="records-per-page">
                                <span>Mostrar:</span>
                                <select id="ejesPerPage" class="records-select">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table id="ejeTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre del Eje</th>
                                        <th>Descripción del Objetivo</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="ejeTableBody">
                                    <!-- Eje rows will be dynamically added here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Paginación -->
                        <div class="pagination-container" id="ejesPagination">
                            <div class="pagination-info" id="ejesInfo"></div>
                            <div class="pagination" id="ejesPaginationControls"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Indicadores Page -->
            <div id="indicadores" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Indicadores</h3>
                        <button class="btn btn-primary" id="addIndicadorBtn">
                            <i class="fas fa-plus"></i> Crear Indicador
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Buscador y paginación -->
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="searchIndicadores" class="search-input" placeholder="Buscar indicadores...">
                            </div>
                            <div class="records-per-page">
                                <span>Mostrar:</span>
                                <select id="indicadoresPerPage" class="records-select">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table id="indicadoresTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Código</th>
                                        <th>Descripción</th>
                                        <th>Eje</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="indicadoresTableBodyPagina">
                                    <!-- Indicador rows will be dynamically added here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Paginación -->
                        <div class="pagination-container" id="indicadoresPagination">
                            <div class="pagination-info" id="indicadoresInfo"></div>
                            <div class="pagination" id="indicadoresPaginationControls"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Plazo Page -->
            <div id="plazo" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Plazos</h3>
                        <button class="btn btn-primary" id="addPlazoBtn">
                            <i class="fas fa-plus"></i> Crear Plazo
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Buscador y paginación -->
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="searchPlazos" class="search-input" placeholder="Buscar plazos...">
                            </div>
                            <div class="records-per-page">
                                <span>Mostrar:</span>
                                <select id="plazosPerPage" class="records-select">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table id="plazoTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre del Plazo</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="plazoTableBody">
                                    <!-- Plazo rows will be dynamically added here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Paginación -->
                        <div class="pagination-container" id="plazosPagination">
                            <div class="pagination-info" id="plazosInfo"></div>
                            <div class="pagination" id="plazosPaginationControls"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Responsable de Área Page -->
            <div id="responsable" class="page-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Responsable de Área</h3>
                        <button class="btn btn-primary" id="addResponsableBtn">
                            <i class="fas fa-plus"></i> Crear Responsable
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Buscador y paginación -->
                        <div class="search-container">
                            <div class="search-box">
                                <input type="text" id="searchResponsables" class="search-input" placeholder="Buscar responsables...">
                            </div>
                            <div class="records-per-page">
                                <span>Mostrar:</span>
                                <select id="responsablesPerPage" class="records-select">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table id="responsableTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre del Responsable</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="responsableTableBody">
                                    <!-- Responsable rows will be dynamically added here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Paginación -->
                        <div class="pagination-container" id="responsablesPagination">
                            <div class="pagination-info" id="responsablesInfo"></div>
                            <div class="pagination" id="responsablesPaginationControls"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Crear Usuario</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Usuario</label>
                    <input type="text" id="newUsername" class="form-control" placeholder="Ingrese el usuario">
                </div>
                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <input type="password" id="newPassword" class="form-control" placeholder="Ingrese la contraseña">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="saveUserBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Add Plan Modal -->
    <div id="addPlanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Crear Plan Operativo</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre Elaborado</label>
                    <input type="text" id="elaboradoName" class="form-control" placeholder="Nombre completo del elaborador">
                </div>
                <div class="form-group">
                    <label class="form-label">Nombre Responsable</label>
                    <input type="text" id="responsableName" class="form-control" placeholder="Nombre completo del responsable">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="savePlanBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Elaboracion Modal -->
    <div id="elaboracionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Información de Elaboración</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Pestañas para elaboración -->
                <div class="tabs-container">
                    <button class="tab-btn active" data-tab="formulario">Formulario</button>
                    <button class="tab-btn" data-tab="imprimir">Imprimir/PDF</button>
                </div>
                
                <!-- Contenido de pestaña de formulario -->
                <div id="tab-formulario" class="tab-content active">
                    <div class="elaboracion-form">
                        <h2 class="elaboracion-title">PLAN OPERATIVO ANUAL 2024</h2>
                        
                        <div class="form-group">
                            <label class="form-label">TEMA</label>
                            <div class="custom-select">
                                <select id="elaboracionTema" required>
                                    <option value="">-- Seleccione un Tema --</option>
                                </select>
                            </div>
                            <div class="error-message" id="errorTema">Este campo es requerido</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">OBJETIVO</label>
                            <div class="custom-select">
                                <select id="elaboracionObjetivo" required>
                                    <option value="">-- Seleccione un Objetivo --</option>
                                </select>
                            </div>
                            <div class="info-text">Al seleccionar un objetivo, el eje se completará automáticamente</div>
                            <div class="error-message" id="errorObjetivo">Este campo es requerido</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label eje-disabled-label">EJE</label>
                            <div class="custom-select">
                                <select id="elaboracionEje" class="eje-disabled" disabled>
                                    <option value="">-- Se completará automáticamente --</option>
                                </select>
                            </div>
                            <div class="info-text">Este campo se completa automáticamente según el objetivo seleccionado</div>
                        </div>
                        
                        <div class="form-group">
                            <div class="item-titulo" id="elaboracionItemTitulo">ITEM DESCRIPCIÓN</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">INDICADOR <span class="info-text">(Seleccione un indicador predefinido)</span></label>
                            <div id="indicadoresPredeterminadosContainer" class="indicadores-container">
                                <!-- Los indicadores predefinidos se cargarán aquí -->
                            </div>
                            <div class="error-message" id="errorIndicador">Debe seleccionar un indicador</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">INDICADOR SELECCIONADO</label>
                                    <input type="text" class="form-control indicador-input" id="elaboracionIndicador" placeholder="Ej: 1.1.1" readonly required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">LÍNEA BASE <span class="info-text">(0-100%)</span></label>
                                    <input type="text" class="form-control porcentaje-input" id="elaboracionLineaBase" placeholder="Ej: 75%" required>
                                    <div class="error-message" id="errorLineaBase">Formato requerido: número 0-100 con % (ej: 75%)</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">POLÍTICAS</label>
                                    <textarea class="form-control" id="elaboracionPoliticas" rows="2" placeholder="Ingrese las políticas" required></textarea>
                                    <div class="error-message" id="errorPoliticas">Este campo es requerido</div>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">METAS</label>
                                    <textarea class="form-control" id="elaboracionMetas" rows="2" placeholder="Ingrese las metas" required></textarea>
                                    <div class="error-message" id="errorMetas">Este campo es requerido</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ACTIVIDADES</label>
                            <textarea class="form-control" id="elaboracionActividades" rows="3" placeholder="Ingrese las actividades" required></textarea>
                            <div class="error-message" id="errorActividades">Este campo es requerido</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">INDICADOR DE RESULTADO</label>
                            <textarea class="form-control" id="elaboracionIndicadorResultado" rows="2" placeholder="Ingrese el indicador de resultado" required></textarea>
                            <div class="error-message" id="errorIndicadorResultado">Este campo es requerido</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">MEDIO DE VERIFICACIÓN</label>
                            <table class="medio-verificacion-table" id="medioVerificacionTable">
                                <thead>
                                    <tr>
                                        <th>DETALLE</th>
                                        <th>PLAZO</th>
                                        <th width="80">ACCIONES</th>
                                    </tr>
                                </thead>
                                <tbody id="medioVerificacionBody">
                                    <!-- Filas dinámicas se agregarán aquí -->
                                </tbody>
                            </table>
                            <div class="medio-verificacion-actions">
                                <button class="btn btn-success btn-sm" id="addMedioVerificacionRow">
                                    <i class="fas fa-plus"></i> Agregar Fila
                                </button>
                            </div>
                            <div class="error-message" id="errorMedioVerificacion">Debe agregar al menos un medio de verificación</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">RESPONSABLE</label>
                            <div class="custom-select">
                                <select id="elaboracionResponsable" required>
                                    <option value="">-- Seleccione un Responsable --</option>
                                </select>
                            </div>
                            <div class="error-message" id="errorResponsable">Este campo es requerido</div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">NOMBRE ELABORADO</label>
                                    <input type="text" class="form-control" id="elaboracionNombreElaborado" readonly>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">NOMBRE RESPONSABLE</label>
                                    <input type="text" class="form-control" id="elaboracionNombreResponsable" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">FECHA DE ELABORACIÓN</label>
                            <input type="date" class="form-control fecha-field" id="elaboracionFecha" required>
                            <div class="error-message" id="errorFecha">Este campo es requerido</div>
                        </div>
                    </div>
                </div>
                
                <!-- Contenido de pestaña de imprimir/PDF -->
                <div id="tab-imprimir" class="tab-content">
                    <div class="print-section">
                        <h3>Exportar Documento de Elaboración</h3>
                        <p>Esta opción está disponible cuando el plan está completado (Elaboración, Seguimiento y Ejecución).</p>
                        
                        <div id="printPreviewContainer">
                            <!-- Vista previa de impresión se cargará aquí -->
                        </div>
                        
                        <div class="form-group" style="margin-top: 20px;">
                            <button class="btn btn-success" id="generarPDFBtn" disabled>
                                <i class="fas fa-file-pdf"></i> Descargar PDF
                            </button>
                            <button class="btn btn-primary" id="imprimirBtn" disabled>
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                            <button class="btn btn-info" id="vistaPreviaBtn">
                                <i class="fas fa-eye"></i> Vista Previa
                            </button>
                        </div>
                        
                        <!-- Opciones adicionales para PDF -->
                        <div class="form-group" style="margin-top: 15px;">
                            <label class="form-label">Opciones de PDF:</label>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <div>
                                    <input type="checkbox" id="incluirFirmas" checked>
                                    <label for="incluirFirmas">Incluir firmas</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="incluirLogos" checked>
                                    <label for="incluirLogos">Incluir logos</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="incluirFecha" checked>
                                    <label for="incluirFecha">Incluir fecha</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary save-btn" id="saveElaboracionBtn" disabled>Guardar Elaboración</button>
            </div>
        </div>
    </div>

    <!-- Seguimiento Modal -->
    <div id="seguimientoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Seguimiento del Plan</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="seguimiento-form">
                    <h2 class="seguimiento-title">SEGUIMIENTO DEL PLAN OPERATIVO</h2>
                    
                    <!-- Información de solo lectura -->
                    <div class="form-group">
                        <label class="form-label">TEMA</label>
                        <input type="text" class="form-control read-only-field" id="seguimientoTema" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">OBJETIVO</label>
                        <input type="text" class="form-control read-only-field" id="seguimientoObjetivo" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">EJE</label>
                        <input type="text" class="form-control read-only-field" id="seguimientoEje" readonly>
                    </div>
                    
                    <div class="form-group">
                        <div class="item-titulo" id="seguimientoItemTitulo">ITEM DESCRIPCIÓN</div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">INDICADOR</label>
                                <input type="text" class="form-control read-only-field indicador-input" id="seguimientoIndicador" readonly>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">LÍNEA BASE</label>
                                <input type="text" class="form-control read-only-field porcentaje-input" id="seguimientoLineaBase" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">POLÍTICAS</label>
                                <textarea class="form-control read-only-field" id="seguimientoPoliticas" rows="2" readonly></textarea>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">METAS</label>
                                <textarea class="form-control read-only-field" id="seguimientoMetas" rows="2" readonly></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ACTIVIDADES</label>
                        <textarea class="form-control read-only-field" id="seguimientoActividades" rows="3" readonly></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">INDICADOR DE RESULTADO</label>
                        <textarea class="form-control read-only-field" id="seguimientoIndicadorResultado" rows="2" readonly></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">MEDIO DE VERIFICACIÓN - SEGUIMIENTO</label>
                        <table class="medio-verificacion-table" id="seguimientoMedioVerificacionTable">
                            <thead>
                                <tr>
                                    <th>DETALLE</th>
                                    <th>PLAZO</th>
                                    <th>CUMPLIMIENTO</th>
                                    <th width="100">OBSERVACIONES</th>
                                </tr>
                            </thead>
                            <tbody id="seguimientoMedioVerificacionBody">
                                <!-- Filas dinámicas se agregarán aquí -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">RESPONSABLE</label>
                        <input type="text" class="form-control read-only-field" id="seguimientoResponsable" readonly>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">NOMBRE ELABORADO</label>
                                <input type="text" class="form-control read-only-field" id="seguimientoNombreElaborado" readonly>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">NOMBRE RESPONSABLE</label>
                                <input type="text" class="form-control read-only-field" id="seguimientoNombreResponsable" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">FECHA DE SEGUIMIENTO</label>
                        <input type="date" class="form-control fecha-field" id="seguimientoFecha" required>
                        <div class="error-message" id="errorSeguimientoFecha">Este campo es requerido</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-warning save-btn" id="saveSeguimientoBtn">Guardar Seguimiento</button>
            </div>
        </div>
    </div>

    <!-- Ejecucion Modal -->
    <div id="ejecucionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Subir Documentos de Ejecución</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Plan: <span id="ejecucionPlanTitle"></span></label>
                </div>
                
                <div class="file-upload-container" id="fileUploadContainer">
                    <div class="file-upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="file-upload-text">
                        <h4>Subir Documentos PDF</h4>
                        <p>Arrastra y suelta tus archivos PDF aquí o haz clic para seleccionarlos</p>
                    </div>
                    <input type="file" id="fileInput" class="file-input" accept=".pdf" multiple>
                    <button class="btn btn-primary" id="selectFilesBtn">
                        <i class="fas fa-folder-open"></i> Seleccionar Archivos
                    </button>
                </div>
                
                <div class="file-list" id="fileList">
                    <h4>Documentos Subidos</h4>
                    <div id="uploadedFiles">
                        <!-- Los archivos subidos aparecerán aquí -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">FECHA DE EJECUCIÓN</label>
                    <input type="date" class="form-control fecha-field" id="ejecucionFecha" required>
                    <div class="error-message" id="errorEjecucionFecha">Este campo es requerido</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-success" id="saveEjecucionBtn">Guardar Documentos</button>
            </div>
        </div>
    </div>

    <!-- Add Tema Modal -->
    <div id="addTemaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Crear Tema POA</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre del Tema</label>
                    <input type="text" id="temaName" class="form-control" placeholder="Ingrese el nombre del tema">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="saveTemaBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Add Eje Modal -->
    <div id="addEjeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Crear Eje y Objetivo</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre del Eje</label>
                    <input type="text" id="ejeName" class="form-control" placeholder="Ingrese el nombre del eje">
                </div>
                <div class="form-group">
                    <label class="form-label">Descripción del Objetivo</label>
                    <textarea class="form-control" id="objetivoDesc" placeholder="Ingrese la descripción del objetivo" rows="4"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="saveEjeBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Edit Eje Modal -->
    <div id="editEjeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Eje y Objetivo</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre del Eje</label>
                    <input type="text" id="editEjeName" class="form-control" placeholder="Ingrese el nombre del eje">
                </div>
                <div class="form-group">
                    <label class="form-label">Descripción del Objetivo</label>
                    <textarea class="form-control" id="editObjetivoDesc" placeholder="Ingrese la descripción del objetivo" rows="4"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="updateEjeBtn">Actualizar</button>
            </div>
        </div>
    </div>

    <!-- Add Indicador Modal -->
    <div id="addIndicadorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Crear Indicador</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Código del Indicador</label>
                    <input type="text" id="indicadorCodigo" class="form-control" placeholder="Ej: 1.1.1">
                </div>
                <div class="form-group">
                    <label class="form-label">Descripción del Indicador</label>
                    <textarea class="form-control" id="indicadorDescripcion" placeholder="Ingrese la descripción del indicador" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Eje al que pertenece</label>
                    <div class="custom-select">
                        <select id="indicadorEje">
                            <option value="">-- Seleccione un Eje --</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="saveIndicadorBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Edit Indicador Modal -->
    <div id="editIndicadorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Indicador</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Código del Indicador</label>
                    <input type="text" id="editIndicadorCodigo" class="form-control" placeholder="Ej: 1.1.1">
                </div>
                <div class="form-group">
                    <label class="form-label">Descripción del Indicador</label>
                    <textarea class="form-control" id="editIndicadorDescripcion" placeholder="Ingrese la descripción del indicador" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Eje al que pertenece</label>
                    <div class="custom-select">
                        <select id="editIndicadorEje">
                            <option value="">-- Seleccione un Eje --</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="updateIndicadorBtn">Actualizar</button>
            </div>
        </div>
    </div>

    <!-- Add Plazo Modal -->
    <div id="addPlazoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Crear Plazo</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre del Plazo</label>
                    <input type="text" id="plazoName" class="form-control" placeholder="Ingrese el nombre del plazo">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="savePlazoBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Edit Plazo Modal -->
    <div id="editPlazoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Plazo</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre del Plazo</label>
                    <input type="text" id="editPlazoName" class="form-control" placeholder="Ingrese el nombre del plazo">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="updatePlazoBtn">Actualizar</button>
            </div>
        </div>
    </div>

    <!-- Add Responsable Modal -->
    <div id="addResponsableModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Crear Responsable de Área</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre del Responsable</label>
                    <input type="text" id="responsableNombre" class="form-control" placeholder="Ingrese el nombre del responsable">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="saveResponsableBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Edit Responsable Modal -->
    <div id="editResponsableModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Responsable de Área</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre del Responsable</label>
                    <input type="text" id="editResponsableNombre" class="form-control" placeholder="Ingrese el nombre del responsable">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="updateResponsableBtn">Actualizar</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== DATOS INICIALES ====================
        
        // Sample data
        let users = [
            { id: 1, username: "admin", password: "admin123" },
            { id: 2, username: "maria.garcia", password: "password123" },
            { id: 3, username: "juan.perez", password: "password123" },
            { id: 4, username: "ana.lopez", password: "password123" },
            { id: 5, username: "carlos.martinez", password: "password123" },
            { id: 6, username: "lucia.rodriguez", password: "password123" },
            { id: 7, username: "pedro.gomez", password: "password123" },
            { id: 8, username: "sofia.hernandez", password: "password123" },
            { id: 9, username: "david.torres", password: "password123" },
            { id: 10, username: "elena.sanchez", password: "password123" },
            { id: 11, username: "miguel.diaz", password: "password123" },
            { id: 12, username: "isabel.ruiz", password: "password123" }
        ];
        
        let plans = [
            { 
                id: 1, 
                elaborado: "Andres Carvajal", 
                responsable: "María García",
                estado: "pendiente",
                elaboracion: { 
                    estado: false, 
                    contenido: "",
                    tema: "",
                    objetivo: "",
                    eje: "",
                    item: "ITEM DESCRIPCIÓN",
                    indicador: "",
                    descripcionIndicador: "",
                    lineaBase: "",
                    politicas: "",
                    metas: "",
                    actividades: "",
                    indicadorResultado: "",
                    medioVerificacion: [],
                    responsable: "",
                    fecha: ""
                }, 
                seguimiento: { 
                    estado: false, 
                    contenido: "",
                    cumplimiento: [],
                    fecha: ""
                }, 
                ejecucion: { 
                    estado: false, 
                    contenido: "", 
                    archivos: [],
                    fecha: ""
                } 
            },
            { 
                id: 2, 
                elaborado: "Carlos Mendoza", 
                responsable: "Juan Pérez",
                estado: "en proceso",
                elaboracion: { 
                    estado: true, 
                    contenido: "",
                    tema: "1",
                    objetivo: "1",
                    eje: "1",
                    item: "ITEM DESCRIPCIÓN",
                    indicador: "1.1.1",
                    descripcionIndicador: "Número de programas académicos actualizados",
                    lineaBase: "75%",
                    politicas: "Políticas de actualización curricular",
                    metas: "Actualizar 5 programas académicos",
                    actividades: "Revisión curricular, actualización de contenidos",
                    indicadorResultado: "Programas actualizados implementados",
                    medioVerificacion: [],
                    responsable: "1",
                    fecha: "2024-01-15"
                }, 
                seguimiento: { 
                    estado: false, 
                    contenido: "",
                    cumplimiento: [],
                    fecha: ""
                }, 
                ejecucion: { 
                    estado: false, 
                    contenido: "", 
                    archivos: [],
                    fecha: ""
                } 
            },
            { 
                id: 3, 
                elaborado: "Ana López", 
                responsable: "Vicerrector de Investigación",
                estado: "completado",
                elaboracion: { 
                    estado: true, 
                    contenido: "",
                    tema: "2",
                    objetivo: "2",
                    eje: "2",
                    item: "ITEM DESCRIPCIÓN",
                    indicador: "2.1.1",
                    descripcionIndicador: "Número de proyectos de investigación activos",
                    lineaBase: "60%",
                    politicas: "Fomentar la investigación",
                    metas: "10 proyectos de investigación",
                    actividades: "Convocatorias, seguimiento de proyectos",
                    indicadorResultado: "Proyectos de investigación ejecutados",
                    medioVerificacion: [],
                    responsable: "2",
                    fecha: "2024-02-10"
                }, 
                seguimiento: { 
                    estado: true, 
                    contenido: "",
                    cumplimiento: [],
                    fecha: "2024-03-15"
                }, 
                ejecucion: { 
                    estado: true, 
                    contenido: "", 
                    archivos: [{id: 1, name: "informe_ejecucion.pdf", size: 2048000, type: "application/pdf", uploadDate: "2024-04-01"}],
                    fecha: "2024-04-01"
                } 
            },
            { 
                id: 4, 
                elaborado: "Luis Ramírez", 
                responsable: "Vicerrector de Vinculación",
                estado: "en proceso",
                elaboracion: { 
                    estado: true, 
                    contenido: "",
                    tema: "1",
                    objetivo: "3",
                    eje: "3",
                    item: "ITEM DESCRIPCIÓN",
                    indicador: "3.1.1",
                    descripcionIndicador: "Convenios activos con instituciones",
                    lineaBase: "80%",
                    politicas: "Establecer alianzas estratégicas",
                    metas: "15 convenios activos",
                    actividades: "Negociación, firma de convenios",
                    indicadorResultado: "Convenios implementados",
                    medioVerificacion: [],
                    responsable: "3",
                    fecha: "2024-01-20"
                }, 
                seguimiento: { 
                    estado: true, 
                    contenido: "",
                    cumplimiento: [],
                    fecha: "2024-02-28"
                }, 
                ejecucion: { 
                    estado: false, 
                    contenido: "", 
                    archivos: [],
                    fecha: ""
                } 
            },
            { 
                id: 5, 
                elaborado: "Marta Sánchez", 
                responsable: "Director de Gestión Administrativa",
                estado: "pendiente",
                elaboracion: { 
                    estado: false, 
                    contenido: "",
                    tema: "",
                    objetivo: "",
                    eje: "",
                    item: "ITEM DESCRIPCIÓN",
                    indicador: "",
                    descripcionIndicador: "",
                    lineaBase: "",
                    politicas: "",
                    metas: "",
                    actividades: "",
                    indicadorResultado: "",
                    medioVerificacion: [],
                    responsable: "",
                    fecha: ""
                }, 
                seguimiento: { 
                    estado: false, 
                    contenido: "",
                    cumplimiento: [],
                    fecha: ""
                }, 
                ejecucion: { 
                    estado: false, 
                    contenido: "", 
                    archivos: [],
                    fecha: ""
                } 
            },
            { 
                id: 6, 
                elaborado: "Roberto Jiménez", 
                responsable: "Coordinador de Internacionalización",
                estado: "completado",
                elaboracion: { 
                    estado: true, 
                    contenido: "",
                    tema: "2",
                    objetivo: "5",
                    eje: "5",
                    item: "ITEM DESCRIPCIÓN",
                    indicador: "5.1.1",
                    descripcionIndicador: "Número de estudiantes en movilidad internacional",
                    lineaBase: "50%",
                    politicas: "Promover la movilidad estudiantil",
                    metas: "25 estudiantes en movilidad",
                    actividades: "Convocatorias, selección, seguimiento",
                    indicadorResultado: "Estudiantes que completaron movilidad",
                    medioVerificacion: [],
                    responsable: "5",
                    fecha: "2024-01-05"
                }, 
                seguimiento: { 
                    estado: true, 
                    contenido: "",
                    cumplimiento: [],
                    fecha: "2024-03-10"
                }, 
                ejecucion: { 
                    estado: true, 
                    contenido: "", 
                    archivos: [{id: 2, name: "reporte_movilidad.pdf", size: 1536000, type: "application/pdf", uploadDate: "2024-04-15"}],
                    fecha: "2024-04-15"
                } 
            }
        ];
        
        let temas = [
            { id: 1, nombre: "ELABORACION POA 2024" },
            { id: 2, nombre: "ELABORACION POA 2025" },
            { id: 3, nombre: "ACTUALIZACIÓN CURRICULAR" },
            { id: 4, nombre: "PROYECTOS DE INVESTIGACIÓN" },
            { id: 5, nombre: "VINCULACIÓN CON LA SOCIEDAD" },
            { id: 6, nombre: "GESTIÓN ADMINISTRATIVA" },
            { id: 7, nombre: "INTERNACIONALIZACIÓN" },
            { id: 8, nombre: "DESARROLLO DOCENTE" },
            { id: 9, nombre: "INNOVACIÓN EDUCATIVA" },
            { id: 10, nombre: "CALIDAD ACADÉMICA" },
            { id: 11, nombre: "INFRAESTRUCTURA" },
            { id: 12, nombre: "BIENESTAR ESTUDIANTIL" }
        ];
        
        // ==================== 5 EJES CON SUS INDICADORES ====================
        let ejes = [
            { 
                id: 1, 
                nombre: "Docencia", 
                objetivo: "Capacitar técnica y tecnológicamente a la sociedad en el área de turístico, patrimonio cultural y carreras afines, propiciar la inserción laboral y apoyar el desarrollo de las matrices productivas y de servicios",
                indicadores: [
                    { id: 1, codigo: "1.1.1", descripcion: "Número de programas académicos actualizados" },
                    { id: 2, codigo: "1.1.2", descripcion: "Porcentaje de satisfacción estudiantil" },
                    { id: 3, codigo: "1.2.1", descripcion: "Tasa de graduación por cohorte" },
                    { id: 4, codigo: "1.2.2", descripcion: "Número de estudiantes en prácticas profesionales" },
                    { id: 5, codigo: "1.3.1", descripcion: "Número de docentes capacitados" },
                    { id: 6, codigo: "1.3.2", descripcion: "Implementación de nuevas metodologías" }
                ]
            },
            { 
                id: 2, 
                nombre: "Investigación", 
                objetivo: "Fomentar la investigación científica y tecnológica para contribuir al desarrollo del conocimiento y la solución de problemas nacionales",
                indicadores: [
                    { id: 7, codigo: "2.1.1", descripcion: "Número de proyectos de investigación activos" },
                    { id: 8, codigo: "2.1.2", descripcion: "Publicaciones indexadas por año" },
                    { id: 9, codigo: "2.2.1", descripcion: "Financiamiento obtenido para investigación" },
                    { id: 10, codigo: "2.2.2", descripcion: "Patentes y registros de propiedad intelectual" },
                    { id: 11, codigo: "2.3.1", descripcion: "Colaboraciones internacionales en investigación" },
                    { id: 12, codigo: "2.3.2", descripcion: "Formación de investigadores" }
                ]
            },
            { 
                id: 3, 
                nombre: "Vinculación", 
                objetivo: "Establecer vínculos estratégicos con la comunidad, el sector productivo y otras instituciones para promover el desarrollo social",
                indicadores: [
                    { id: 13, codigo: "3.1.1", descripcion: "Convenios activos con instituciones" },
                    { id: 14, codigo: "3.1.2", descripcion: "Proyectos de extensión comunitaria" },
                    { id: 15, codigo: "3.2.1", descripcion: "Eventos de vinculación realizados" },
                    { id: 16, codigo: "3.2.2", descripcion: "Participación en redes institucionales" },
                    { id: 17, codigo: "3.3.1", descripcion: "Servicios a la comunidad" },
                    { id: 18, codigo: "3.3.2", descripcion: "Transferencia de tecnología" }
                ]
            },
            { 
                id: 4, 
                nombre: "Gestión", 
                objetivo: "Optimizar los procesos administrativos y la gestión de recursos para asegurar la eficiencia institucional",
                indicadores: [
                    { id: 19, codigo: "4.1.1", descripcion: "Porcentaje de cumplimiento de metas institucionales" },
                    { id: 20, codigo: "4.1.2", descripcion: "Nivel de satisfacción del personal administrativo" },
                    { id: 21, codigo: "4.2.1", descripcion: "Eficiencia en la ejecución presupuestaria" },
                    { id: 22, codigo: "4.2.2", descripcion: "Tiempo promedio de respuesta a solicitudes" },
                    { id: 23, codigo: "4.3.1", descripcion: "Modernización de procesos" },
                    { id: 24, codigo: "4.3.2", descripcion: "Gestión de recursos tecnológicos" }
                ]
            },
            { 
                id: 5, 
                nombre: "Internacionalización", 
                objetivo: "Promover la movilidad académica y la cooperación internacional para fortalecer la calidad educativa",
                indicadores: [
                    { id: 25, codigo: "5.1.1", descripcion: "Número de estudiantes en movilidad internacional" },
                    { id: 26, codigo: "5.1.2", descripcion: "Convenios internacionales activos" },
                    { id: 27, codigo: "5.2.1", descripcion: "Participación en proyectos internacionales" },
                    { id: 28, codigo: "5.2.2", descripcion: "Visitas de expertos internacionales" },
                    { id: 29, codigo: "5.3.1", descripcion: "Programas de doble titulación" },
                    { id: 30, codigo: "5.3.2", descripcion: "Internacionalización del currículo" }
                ]
            }
        ];
        
        let plazos = [
            { id: 1, nombre: "Anual" },
            { id: 2, nombre: "Semestral" },
            { id: 3, nombre: "Trimestral" },
            { id: 4, nombre: "Mensual" },
            { id: 5, nombre: "Bimestral" },
            { id: 6, nombre: "Cuatrimestral" }
        ];
        
        let responsables = [
            { id: 1, nombre: "Vicerrector Académico" },
            { id: 2, nombre: "Vicerrector de Investigación" },
            { id: 3, nombre: "Vicerrector de Vinculación" },
            { id: 4, nombre: "Director de Gestión Administrativa" },
            { id: 5, nombre: "Coordinador de Internacionalización" },
            { id: 6, nombre: "Decano de Facultad" },
            { id: 7, nombre: "Director de Carrera" },
            { id: 8, nombre: "Coordinador de Investigación" },
            { id: 9, nombre: "Jefe de Departamento" },
            { id: 10, nombre: "Coordinador de Proyectos" }
        ];
        
        // ==================== VARIABLES GLOBALES ====================
        
        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const app = document.getElementById('app');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const pageTitle = document.getElementById('pageTitle');
        const currentUser = document.getElementById('currentUser');
        const userAvatar = document.getElementById('userAvatar');
        const sidebarItems = document.querySelectorAll('.sidebar-menu li');
        const pageContents = document.querySelectorAll('.page-content');
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const closeSidebar = document.getElementById('closeSidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const mainContent = document.getElementById('mainContent');
        
        // Modals
        const modals = document.querySelectorAll('.modal');
        const addUserModal = document.getElementById('addUserModal');
        const addPlanModal = document.getElementById('addPlanModal');
        const elaboracionModal = document.getElementById('elaboracionModal');
        const seguimientoModal = document.getElementById('seguimientoModal');
        const ejecucionModal = document.getElementById('ejecucionModal');
        const addTemaModal = document.getElementById('addTemaModal');
        const addEjeModal = document.getElementById('addEjeModal');
        const editEjeModal = document.getElementById('editEjeModal');
        const addIndicadorModal = document.getElementById('addIndicadorModal');
        const editIndicadorModal = document.getElementById('editIndicadorModal');
        const addPlazoModal = document.getElementById('addPlazoModal');
        const editPlazoModal = document.getElementById('editPlazoModal');
        const addResponsableModal = document.getElementById('addResponsableModal');
        const editResponsableModal = document.getElementById('editResponsableModal');
        
        // Buttons
        const addUserBtn = document.getElementById('addUserBtn');
        const addPlanBtn = document.getElementById('addPlanBtn');
        const addTemaBtn = document.getElementById('addTemaBtn');
        const addEjeBtn = document.getElementById('addEjeBtn');
        const addIndicadorBtn = document.getElementById('addIndicadorBtn');
        const addPlazoBtn = document.getElementById('addPlazoBtn');
        const addResponsableBtn = document.getElementById('addResponsableBtn');
        const saveUserBtn = document.getElementById('saveUserBtn');
        const savePlanBtn = document.getElementById('savePlanBtn');
        const saveElaboracionBtn = document.getElementById('saveElaboracionBtn');
        const saveSeguimientoBtn = document.getElementById('saveSeguimientoBtn');
        const saveEjecucionBtn = document.getElementById('saveEjecucionBtn');
        const saveTemaBtn = document.getElementById('saveTemaBtn');
        const saveEjeBtn = document.getElementById('saveEjeBtn');
        const updateEjeBtn = document.getElementById('updateEjeBtn');
        const saveIndicadorBtn = document.getElementById('saveIndicadorBtn');
        const updateIndicadorBtn = document.getElementById('updateIndicadorBtn');
        const savePlazoBtn = document.getElementById('savePlazoBtn');
        const updatePlazoBtn = document.getElementById('updatePlazoBtn');
        const saveResponsableBtn = document.getElementById('saveResponsableBtn');
        const updateResponsableBtn = document.getElementById('updateResponsableBtn');
        
        // Tables and Grids
        const usersGrid = document.getElementById('usersGrid');
        const planTableBody = document.getElementById('planTableBody');
        const temaTableBody = document.getElementById('temaTableBody');
        const ejeTableBody = document.getElementById('ejeTableBody');
        const indicadoresTablaBody = document.getElementById('indicadoresTableBodyPagina');
        const plazoTableBody = document.getElementById('plazoTableBody');
        const responsableTableBody = document.getElementById('responsableTableBody');
        
        // Buscadores
        const searchUsers = document.getElementById('searchUsers');
        const searchPlans = document.getElementById('searchPlans');
        const searchTemas = document.getElementById('searchTemas');
        const searchEjes = document.getElementById('searchEjes');
        const searchIndicadores = document.getElementById('searchIndicadores');
        const searchPlazos = document.getElementById('searchPlazos');
        const searchResponsables = document.getElementById('searchResponsables');
        
        // Selects de registros por página
        const usersPerPage = document.getElementById('usersPerPage');
        const plansPerPage = document.getElementById('plansPerPage');
        const temasPerPage = document.getElementById('temasPerPage');
        const ejesPerPage = document.getElementById('ejesPerPage');
        const indicadoresPerPage = document.getElementById('indicadoresPerPage');
        const plazosPerPage = document.getElementById('plazosPerPage');
        const responsablesPerPage = document.getElementById('responsablesPerPage');
        
        // Dashboard Elements
        const totalPlanes = document.getElementById('totalPlanes');
        const usuariosActivos = document.getElementById('usuariosActivos');
        const planesCompletados = document.getElementById('planesCompletados');
        const ejesUtilizados = document.getElementById('ejesUtilizados');
        const statsTableBody = document.getElementById('statsTableBody');
        const indicadoresTableBody = document.getElementById('indicadoresTableBody');
        const barChartCanvas = document.getElementById('barChart');
        const lineChartCanvas = document.getElementById('lineChart');
        const filterBtns = document.querySelectorAll('.filter-btn');
        
        // Análisis detallado
        const estadoEjesList = document.getElementById('estadoEjesList');
        const eficienciaResponsablesList = document.getElementById('eficienciaResponsablesList');
        const distribucionPlanesList = document.getElementById('distribucionPlanesList');
        
        // Elaboracion Form Elements
        const elaboracionTema = document.getElementById('elaboracionTema');
        const elaboracionObjetivo = document.getElementById('elaboracionObjetivo');
        const elaboracionEje = document.getElementById('elaboracionEje');
        const elaboracionItemTitulo = document.getElementById('elaboracionItemTitulo');
        const elaboracionIndicador = document.getElementById('elaboracionIndicador');
        const indicadoresPredeterminadosContainer = document.getElementById('indicadoresPredeterminadosContainer');
        const elaboracionLineaBase = document.getElementById('elaboracionLineaBase');
        const elaboracionPoliticas = document.getElementById('elaboracionPoliticas');
        const elaboracionMetas = document.getElementById('elaboracionMetas');
        const elaboracionActividades = document.getElementById('elaboracionActividades');
        const elaboracionIndicadorResultado = document.getElementById('elaboracionIndicadorResultado');
        const medioVerificacionBody = document.getElementById('medioVerificacionBody');
        const addMedioVerificacionRow = document.getElementById('addMedioVerificacionRow');
        const elaboracionResponsable = document.getElementById('elaboracionResponsable');
        const elaboracionNombreElaborado = document.getElementById('elaboracionNombreElaborado');
        const elaboracionNombreResponsable = document.getElementById('elaboracionNombreResponsable');
        const elaboracionFecha = document.getElementById('elaboracionFecha');
        
        // Seguimiento Form Elements
        const seguimientoTema = document.getElementById('seguimientoTema');
        const seguimientoObjetivo = document.getElementById('seguimientoObjetivo');
        const seguimientoEje = document.getElementById('seguimientoEje');
        const seguimientoItemTitulo = document.getElementById('seguimientoItemTitulo');
        const seguimientoIndicador = document.getElementById('seguimientoIndicador');
        const seguimientoLineaBase = document.getElementById('seguimientoLineaBase');
        const seguimientoPoliticas = document.getElementById('seguimientoPoliticas');
        const seguimientoMetas = document.getElementById('seguimientoMetas');
        const seguimientoActividades = document.getElementById('seguimientoActividades');
        const seguimientoIndicadorResultado = document.getElementById('seguimientoIndicadorResultado');
        const seguimientoMedioVerificacionBody = document.getElementById('seguimientoMedioVerificacionBody');
        const seguimientoResponsable = document.getElementById('seguimientoResponsable');
        const seguimientoNombreElaborado = document.getElementById('seguimientoNombreElaborado');
        const seguimientoNombreResponsable = document.getElementById('seguimientoNombreResponsable');
        const seguimientoFecha = document.getElementById('seguimientoFecha');
        
        // Ejecucion Form Elements
        const ejecucionPlanTitle = document.getElementById('ejecucionPlanTitle');
        const fileUploadContainer = document.getElementById('fileUploadContainer');
        const fileInput = document.getElementById('fileInput');
        const selectFilesBtn = document.getElementById('selectFilesBtn');
        const uploadedFiles = document.getElementById('uploadedFiles');
        const ejecucionFecha = document.getElementById('ejecucionFecha');
        
        // Nuevos elementos para imprimir/PDF
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const printPreviewContainer = document.getElementById('printPreviewContainer');
        const generarPDFBtn = document.getElementById('generarPDFBtn');
        const imprimirBtn = document.getElementById('imprimirBtn');
        const vistaPreviaBtn = document.getElementById('vistaPreviaBtn');
        
        // Current plan being edited
        let currentPlanId = null;
        let currentEjecucionFiles = [];
        let medioVerificacionRowCounter = 0;
        let currentDashboardFilter = 'all';
        let selectedIndicador = null;
        let currentEjeIdForIndicadores = null;
        let barChart = null;
        let lineChart = null;
        
        // Variables para paginación
        let currentUsersPage = 1;
        let currentPlansPage = 1;
        let currentTemasPage = 1;
        let currentEjesPage = 1;
        let currentIndicadoresPage = 1;
        let currentPlazosPage = 1;
        let currentResponsablesPage = 1;
        
        // Variables para búsqueda
        let currentUsersSearch = '';
        let currentPlansSearch = '';
        let currentTemasSearch = '';
        let currentEjesSearch = '';
        let currentIndicadoresSearch = '';
        let currentPlazosSearch = '';
        let currentResponsablesSearch = '';
        
        // ==================== FUNCIONES BÁSICAS ====================
        
        // Login functionality
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Check if user exists
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                loginScreen.style.display = 'none';
                app.style.display = 'flex';
                currentUser.textContent = user.username;
                userAvatar.textContent = user.username.charAt(0).toUpperCase();
                showAlert('success', 'Inicio de sesión exitoso');
            } else {
                showAlert('danger', 'Usuario o contraseña incorrectos');
            }
        }
        
        // Logout functionality
        logoutBtn.addEventListener('click', function() {
            app.style.display = 'none';
            loginScreen.style.display = 'flex';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showAlert('success', 'Sesión cerrada correctamente');
        });
        
        // Menu toggle functionality - Only for mobile
        menuToggle.addEventListener('click', function() {
            if (window.innerWidth <= 992) {
                sidebar.classList.add('active');
                sidebarOverlay.classList.add('active');
            }
        });
        
        closeSidebar.addEventListener('click', function() {
            sidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
        });
        
        sidebarOverlay.addEventListener('click', function() {
            sidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
        });
        
        // Navigation
        sidebarItems.forEach(item => {
            item.addEventListener('click', function() {
                const page = this.getAttribute('data-page');
                
                // Update active item
                sidebarItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                // Show selected page
                pageContents.forEach(content => content.style.display = 'none');
                document.getElementById(page).style.display = 'block';
                
                // Update page title
                pageTitle.textContent = this.textContent.trim();
                
                // Close sidebar on mobile only
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                }
                
                // Load page data
                if (page === 'coordinacion') {
                    loadUsers();
                } else if (page === 'plan-operativo') {
                    loadPlans();
                } else if (page === 'dashboard') {
                    loadDashboard();
                } else if (page === 'tema-poa') {
                    loadTemas();
                } else if (page === 'eje-objetivo') {
                    loadEjes();
                } else if (page === 'indicadores') {
                    loadIndicadoresPage();
                } else if (page === 'plazo') {
                    loadPlazos();
                } else if (page === 'responsable') {
                    loadResponsables();
                }
            });
        });
        
        // Modal functionality
        function openModal(modal) {
            modal.style.display = 'flex';
        }
        
        function closeModal(modal) {
            modal.style.display = 'none';
        }
        
        // Close modals when clicking X or cancel button
        document.querySelectorAll('.modal-close').forEach(button => {
            button.addEventListener('click', function() {
                const modal = this.closest('.modal');
                closeModal(modal);
            });
        });
        
        // Close modal when clicking outside
        modals.forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal(this);
                }
            });
        });
        
        // Show alert function
        function showAlert(type, message) {
            // Remove existing alerts
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertContainer = document.body;
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            
            let icon = '';
            if (type === 'success') icon = 'fa-check-circle';
            else if (type === 'danger') icon = 'fa-exclamation-circle';
            else if (type === 'warning') icon = 'fa-exclamation-triangle';
            else if (type === 'info') icon = 'fa-info-circle';
            
            alert.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            `;
            
            alertContainer.appendChild(alert);
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }
        
        // ==================== FUNCIONES PARA PAGINACIÓN Y BÚSQUEDA ====================
        
        // Función genérica para filtrar datos
        function filterData(data, searchTerm, searchFields) {
            if (!searchTerm.trim()) return data;
            
            const term = searchTerm.toLowerCase().trim();
            return data.filter(item => {
                return searchFields.some(field => {
                    const value = item[field];
                    if (typeof value === 'string') {
                        return value.toLowerCase().includes(term);
                    } else if (typeof value === 'number') {
                        return value.toString().includes(term);
                    }
                    return false;
                });
            });
        }
        
        // Función genérica para paginar datos
        function paginateData(data, page, perPage) {
            const startIndex = (page - 1) * perPage;
            const endIndex = startIndex + perPage;
            return {
                items: data.slice(startIndex, endIndex),
                totalItems: data.length,
                totalPages: Math.ceil(data.length / perPage),
                currentPage: page,
                perPage: perPage
            };
        }
        
        // Función para crear controles de paginación
        function createPaginationControls(paginationInfo, paginationContainer, pageChangeCallback) {
            const { totalPages, currentPage, totalItems, perPage, startItem, endItem } = paginationInfo;
            const container = document.getElementById(paginationContainer);
            const infoElement = document.getElementById(paginationContainer.replace('Pagination', 'Info'));
            const controlsElement = document.getElementById(paginationContainer.replace('Pagination', 'PaginationControls'));
            
            if (!container || !infoElement || !controlsElement) return;
            
            // Actualizar información
            const startItemCalc = (currentPage - 1) * perPage + 1;
            const endItemCalc = Math.min(currentPage * perPage, totalItems);
            infoElement.textContent = `Mostrando ${startItemCalc}-${endItemCalc} de ${totalItems} registros`;
            
            // Crear controles de paginación
            controlsElement.innerHTML = '';
            
            if (totalPages <= 1) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'flex';
            
            // Botón anterior
            const prevBtn = document.createElement('button');
            prevBtn.className = `page-btn ${currentPage === 1 ? 'disabled' : ''}`;
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.disabled = currentPage === 1;
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    pageChangeCallback(currentPage - 1);
                }
            });
            controlsElement.appendChild(prevBtn);
            
            // Números de página
            const pageNumbers = document.createElement('div');
            pageNumbers.className = 'page-numbers';
            
            // Mostrar páginas cercanas
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // Primera página si no está visible
            if (startPage > 1) {
                const firstPageBtn = document.createElement('button');
                firstPageBtn.className = 'page-btn';
                firstPageBtn.textContent = '1';
                firstPageBtn.addEventListener('click', () => pageChangeCallback(1));
                pageNumbers.appendChild(firstPageBtn);
                
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'page-btn disabled';
                    ellipsis.textContent = '...';
                    ellipsis.style.cursor = 'default';
                    pageNumbers.appendChild(ellipsis);
                }
            }
            
            // Páginas visibles
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => pageChangeCallback(i));
                pageNumbers.appendChild(pageBtn);
            }
            
            // Última página si no está visible
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'page-btn disabled';
                    ellipsis.textContent = '...';
                    ellipsis.style.cursor = 'default';
                    pageNumbers.appendChild(ellipsis);
                }
                
                const lastPageBtn = document.createElement('button');
                lastPageBtn.className = 'page-btn';
                lastPageBtn.textContent = totalPages;
                lastPageBtn.addEventListener('click', () => pageChangeCallback(totalPages));
                pageNumbers.appendChild(lastPageBtn);
            }
            
            controlsElement.appendChild(pageNumbers);
            
            // Botón siguiente
            const nextBtn = document.createElement('button');
            nextBtn.className = `page-btn ${currentPage === totalPages ? 'disabled' : ''}`;
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    pageChangeCallback(currentPage + 1);
                }
            });
            controlsElement.appendChild(nextBtn);
        }
        
        // ==================== FUNCIONES PARA LA PÁGINA DE INDICADORES ====================
        
        // Función para cargar la página de indicadores
        function loadIndicadoresPage(page = currentIndicadoresPage, searchTerm = currentIndicadoresSearch) {
            // Obtener todos los indicadores de todos los ejes
            let allIndicadores = [];
            ejes.forEach(eje => {
                if (eje.indicadores && eje.indicadores.length > 0) {
                    eje.indicadores.forEach(indicador => {
                        allIndicadores.push({
                            id: indicador.id,
                            codigo: indicador.codigo,
                            descripcion: indicador.descripcion,
                            ejeId: eje.id,
                            ejeNombre: eje.nombre
                        });
                    });
                }
            });
            
            // Filtrar por búsqueda
            if (searchTerm) {
                allIndicadores = filterData(allIndicadores, searchTerm, ['codigo', 'descripcion', 'ejeNombre']);
                currentIndicadoresSearch = searchTerm;
            }
            
            // Ordenar indicadores por código
            allIndicadores.sort((a, b) => a.codigo.localeCompare(b.codigo));
            
            // Paginar
            const perPage = parseInt(indicadoresPerPage.value) || 10;
            const paginated = paginateData(allIndicadores, page, perPage);
            currentIndicadoresPage = page;
            
            // Renderizar tabla
            const tbody = indicadoresTablaBody;
            tbody.innerHTML = '';
            
            if (paginated.items.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>${searchTerm ? 'No se encontraron indicadores con ese criterio de búsqueda' : 'No hay indicadores registrados'}</p>
                    </td>
                `;
                tbody.appendChild(row);
            } else {
                paginated.items.forEach(indicador => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${indicador.id}</td>
                        <td><strong>${indicador.codigo}</strong></td>
                        <td>${indicador.descripcion}</td>
                        <td>${indicador.ejeNombre}</td>
                        <td>
                            <button class="btn btn-primary btn-sm edit-indicador-tabla" data-id="${indicador.id}" data-eje="${indicador.ejeId}">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-danger btn-sm delete-indicador-tabla" data-id="${indicador.id}" data-eje="${indicador.ejeId}">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                // Agregar event listeners para botones de editar y eliminar
                document.querySelectorAll('.edit-indicador-tabla').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const indicadorId = parseInt(this.getAttribute('data-id'));
                        const ejeId = parseInt(this.getAttribute('data-eje'));
                        openEditIndicadorModal(indicadorId, ejeId);
                    });
                });
                
                document.querySelectorAll('.delete-indicador-tabla').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const indicadorId = parseInt(this.getAttribute('data-id'));
                        const ejeId = parseInt(this.getAttribute('data-eje'));
                        deleteIndicadorFromTable(indicadorId, ejeId);
                    });
                });
            }
            
            // Crear paginación
            createPaginationControls({
                totalPages: paginated.totalPages,
                currentPage: page,
                totalItems: paginated.totalItems,
                perPage: perPage
            }, 'indicadoresPagination', (newPage) => {
                loadIndicadoresPage(newPage, currentIndicadoresSearch);
            });
        }
        
        // Función para cargar indicadores predefinidos según el eje seleccionado
        function loadIndicadoresPredeterminados(ejeId) {
            indicadoresPredeterminadosContainer.innerHTML = '';
            selectedIndicador = null;
            
            const eje = ejes.find(e => e.id == ejeId);
            if (!eje || !eje.indicadores) return;
            
            eje.indicadores.forEach(indicador => {
                const indicadorElement = document.createElement('div');
                indicadorElement.className = 'indicador-predeterminado';
                indicadorElement.innerHTML = `
                    <div><strong>${indicador.codigo}</strong></div>
                    <div style="font-size: 12px; color: #666;">${indicador.descripcion}</div>
                `;
                
                indicadorElement.addEventListener('click', function() {
                    // Remover selección anterior
                    document.querySelectorAll('.indicador-predeterminado').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // Seleccionar actual
                    this.classList.add('selected');
                    selectedIndicador = indicador;
                    elaboracionIndicador.value = indicador.codigo;
                    
                    // Validar formulario
                    validateElaboracionForm();
                });
                
                indicadoresPredeterminadosContainer.appendChild(indicadorElement);
            });
        }
        
        // Función para eliminar indicador desde la tabla de indicadores
        function deleteIndicadorFromTable(indicadorId, ejeId) {
            if (confirm('¿Está seguro de que desea eliminar este indicador?')) {
                const eje = ejes.find(e => e.id == ejeId);
                if (!eje) return;
                
                const indicadorIndex = eje.indicadores.findIndex(i => i.id == indicadorId);
                if (indicadorIndex !== -1) {
                    // Eliminar indicador
                    eje.indicadores.splice(indicadorIndex, 1);
                    
                    // Actualizar tabla de indicadores
                    loadIndicadoresPage(currentIndicadoresPage, currentIndicadoresSearch);
                    
                    // Actualizar dashboard si está activo
                    if (document.getElementById('dashboard').style.display === 'block') {
                        updateDashboardStats();
                    }
                    
                    showAlert('success', 'Indicador eliminado exitosamente');
                }
            }
        }
        
        // Función para abrir modal de crear indicador desde la página de indicadores
        function openAddIndicadorModal() {
            document.getElementById('indicadorCodigo').value = '';
            document.getElementById('indicadorDescripcion').value = '';
            
            // Cargar opciones de ejes
            const indicadorEjeSelect = document.getElementById('indicadorEje');
            indicadorEjeSelect.innerHTML = '<option value="">-- Seleccione un Eje --</option>';
            ejes.forEach(eje => {
                const option = document.createElement('option');
                option.value = eje.id;
                option.textContent = eje.nombre;
                indicadorEjeSelect.appendChild(option);
            });
            
            openModal(addIndicadorModal);
        }
        
        // Función para guardar indicador desde la página de indicadores
        saveIndicadorBtn.addEventListener('click', function() {
            const codigo = document.getElementById('indicadorCodigo').value.trim();
            const descripcion = document.getElementById('indicadorDescripcion').value.trim();
            const ejeId = document.getElementById('indicadorEje').value;
            
            if (!codigo || !descripcion || !ejeId) {
                showAlert('warning', 'Por favor complete todos los campos');
                return;
            }
            
            const eje = ejes.find(e => e.id == ejeId);
            if (!eje) return;
            
            // Verificar si el código ya existe en este eje
            const indicadorExistente = eje.indicadores.find(i => i.codigo === codigo);
            if (indicadorExistente) {
                showAlert('warning', 'Ya existe un indicador con este código en este eje');
                return;
            }
            
            // Encontrar el próximo ID disponible
            let nextId = 1;
            ejes.forEach(e => {
                if (e.indicadores && e.indicadores.length > 0) {
                    e.indicadores.forEach(ind => {
                        if (ind.id >= nextId) {
                            nextId = ind.id + 1;
                        }
                    });
                }
            });
            
            // Agregar nuevo indicador
            if (!eje.indicadores) {
                eje.indicadores = [];
            }
            
            eje.indicadores.push({
                id: nextId,
                codigo: codigo,
                descripcion: descripcion
            });
            
            // Cerrar modal
            closeModal(addIndicadorModal);
            
            // Actualizar tabla de indicadores
            loadIndicadoresPage(currentIndicadoresPage, currentIndicadoresSearch);
            
            // Actualizar dashboard si está activo
            if (document.getElementById('dashboard').style.display === 'block') {
                updateDashboardStats();
            }
            
            showAlert('success', 'Indicador creado exitosamente');
        });
        
        // Función para abrir modal de editar indicador
        function openEditIndicadorModal(indicadorId, ejeId) {
            const eje = ejes.find(e => e.id == ejeId);
            if (!eje) return;
            
            const indicador = eje.indicadores.find(i => i.id == indicadorId);
            if (!indicador) return;
            
            // Establecer datos en el formulario
            document.getElementById('editIndicadorCodigo').value = indicador.codigo;
            document.getElementById('editIndicadorDescripcion').value = indicador.descripcion;
            
            // Cargar opciones de ejes
            const editIndicadorEjeSelect = document.getElementById('editIndicadorEje');
            editIndicadorEjeSelect.innerHTML = '<option value="">-- Seleccione un Eje --</option>';
            ejes.forEach(eje => {
                const option = document.createElement('option');
                option.value = eje.id;
                option.textContent = eje.nombre;
                if (eje.id == ejeId) {
                    option.selected = true;
                }
                editIndicadorEjeSelect.appendChild(option);
            });
            
            // Guardar IDs en el modal
            editIndicadorModal.setAttribute('data-indicador-id', indicadorId);
            editIndicadorModal.setAttribute('data-eje-id', ejeId);
            
            openModal(editIndicadorModal);
        }
        
        // Función para actualizar indicador desde la página de indicadores
        updateIndicadorBtn.addEventListener('click', function() {
            const indicadorId = parseInt(editIndicadorModal.getAttribute('data-indicador-id'));
            const oldEjeId = parseInt(editIndicadorModal.getAttribute('data-eje-id'));
            const codigo = document.getElementById('editIndicadorCodigo').value.trim();
            const descripcion = document.getElementById('editIndicadorDescripcion').value.trim();
            const newEjeId = document.getElementById('editIndicadorEje').value;
            
            if (!codigo || !descripcion || !newEjeId) {
                showAlert('warning', 'Por favor complete todos los campos');
                return;
            }
            
            // Buscar el eje original
            const oldEje = ejes.find(e => e.id == oldEjeId);
            if (!oldEje) return;
            
            // Buscar el indicador original
            const indicadorIndex = oldEje.indicadores.findIndex(i => i.id == indicadorId);
            if (indicadorIndex === -1) return;
            
            // Si se cambió de eje, mover el indicador al nuevo eje
            if (oldEjeId != newEjeId) {
                // Buscar el nuevo eje
                const newEje = ejes.find(e => e.id == newEjeId);
                if (!newEje) return;
                
                // Verificar si el código ya existe en el nuevo eje
                const indicadorExistente = newEje.indicadores.find(i => i.codigo === codigo);
                if (indicadorExistente) {
                    showAlert('warning', 'Ya existe un indicador con este código en el eje seleccionado');
                    return;
                }
                
                // Mover indicador al nuevo eje
                const indicador = oldEje.indicadores[indicadorIndex];
                indicador.codigo = codigo;
                indicador.descripcion = descripcion;
                
                if (!newEje.indicadores) {
                    newEje.indicadores = [];
                }
                
                newEje.indicadores.push(indicador);
                oldEje.indicadores.splice(indicadorIndex, 1);
            } else {
                // Mismo eje, solo actualizar
                // Verificar si el código ya existe en otro indicador del mismo eje
                const indicadorExistente = oldEje.indicadores.find((i, idx) => i.codigo === codigo && idx !== indicadorIndex);
                if (indicadorExistente) {
                    showAlert('warning', 'Ya existe un indicador con este código en este eje');
                    return;
                }
                
                // Actualizar indicador
                oldEje.indicadores[indicadorIndex].codigo = codigo;
                oldEje.indicadores[indicadorIndex].descripcion = descripcion;
            }
            
            // Cerrar modal
            closeModal(editIndicadorModal);
            
            // Actualizar tabla de indicadores
            loadIndicadoresPage(currentIndicadoresPage, currentIndicadoresSearch);
            
            // Actualizar dashboard si está activo
            if (document.getElementById('dashboard').style.display === 'block') {
                updateDashboardStats();
            }
            
            showAlert('success', 'Indicador actualizado exitosamente');
        });
        
        // Event listener para el botón de agregar indicador
        addIndicadorBtn.addEventListener('click', openAddIndicadorModal);
        
        // ==================== FUNCIONALIDAD DE PESTAÑAS ====================
        
        // Funcionalidad de pestañas (solo formulario e imprimir)
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Remover clase active de todos los botones y contenidos
                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Agregar clase active al botón clickeado
                this.classList.add('active');
                
                // Mostrar contenido correspondiente
                document.getElementById(`tab-${tabId}`).classList.add('active');
                
                // Si es la pestaña de imprimir, actualizar vista previa
                if (tabId === 'imprimir' && currentPlanId) {
                    printPreviewContainer.innerHTML = generatePrintPreview(currentPlanId);
                    updatePrintButtonsState(currentPlanId);
                }
            });
        });
        
        // ==================== FUNCIONES PARA ELABORACIÓN ====================
        
        // Load custom selects with data
        function loadCustomSelects() {
            // Load temas
            elaboracionTema.innerHTML = '<option value="">-- Seleccione un Tema --</option>';
            temas.forEach(tema => {
                const option = document.createElement('option');
                option.value = tema.id;
                option.textContent = tema.nombre;
                elaboracionTema.appendChild(option);
            });
            
            // Load objetivos from ejes
            elaboracionObjetivo.innerHTML = '<option value="">-- Seleccione un Objetivo --</option>';
            ejes.forEach(eje => {
                const option = document.createElement('option');
                option.value = eje.id;
                option.textContent = eje.objetivo.length > 50 ? eje.objetivo.substring(0, 50) + '...' : eje.objetivo;
                elaboracionObjetivo.appendChild(option);
            });
            
            // Load ejes - pero dejarlo vacío inicialmente
            elaboracionEje.innerHTML = '<option value="">-- Se completará automáticamente --</option>';
            ejes.forEach(eje => {
                const option = document.createElement('option');
                option.value = eje.id;
                option.textContent = eje.nombre;
                elaboracionEje.appendChild(option);
            });
            
            // Deshabilitar el campo de eje
            elaboracionEje.disabled = true;
            elaboracionEje.classList.add('eje-disabled');
            
            // Load responsables
            elaboracionResponsable.innerHTML = '<option value="">-- Seleccione un Responsable --</option>';
            responsables.forEach(responsable => {
                const option = document.createElement('option');
                option.value = responsable.id;
                option.textContent = responsable.nombre;
                elaboracionResponsable.appendChild(option);
            });
        }
        
        // Validar formato de línea base (0-100%)
        function validarFormatoLineaBase(valor) {
            // Patrón: número del 0 al 100 seguido de %
            const patron = /^(100|[1-9]?[0-9])%$/;
            return patron.test(valor);
        }
        
        // Validación de campos obligatorios en elaboración - CORREGIDO
        function validateElaboracionForm() {
            let isValid = true;
            
            // Validar todos los campos obligatorios
            const requiredFields = [
                { element: elaboracionTema, errorId: 'errorTema' },
                { element: elaboracionObjetivo, errorId: 'errorObjetivo' },
                { element: elaboracionPoliticas, errorId: 'errorPoliticas' },
                { element: elaboracionMetas, errorId: 'errorMetas' },
                { element: elaboracionActividades, errorId: 'errorActividades' },
                { element: elaboracionIndicadorResultado, errorId: 'errorIndicadorResultado' },
                { element: elaboracionResponsable, errorId: 'errorResponsable' },
                { element: elaboracionFecha, errorId: 'errorFecha' }
            ];
            
            requiredFields.forEach(field => {
                const value = field.element.value.trim();
                const errorElement = document.getElementById(field.errorId);
                
                if (!value) {
                    field.element.classList.add('error');
                    errorElement.style.display = 'block';
                    isValid = false;
                } else {
                    field.element.classList.remove('error');
                    errorElement.style.display = 'none';
                }
            });
            
            // CORRECCIÓN: Validar indicador seleccionado de forma más flexible
            const indicadorError = document.getElementById('errorIndicador');
            const indicadorValue = elaboracionIndicador.value.trim();
            
            if (!indicadorValue) {
                elaboracionIndicador.classList.add('error');
                indicadorError.style.display = 'block';
                isValid = false;
            } else {
                elaboracionIndicador.classList.remove('error');
                indicadorError.style.display = 'none';
            }
            
            // Validar formato de línea base
            const lineaBaseValue = elaboracionLineaBase.value.trim();
            const lineaBaseError = document.getElementById('errorLineaBase');
            
            if (!lineaBaseValue) {
                elaboracionLineaBase.classList.add('error');
                lineaBaseError.textContent = 'Este campo es requerido';
                lineaBaseError.style.display = 'block';
                isValid = false;
            } else if (!validarFormatoLineaBase(lineaBaseValue)) {
                elaboracionLineaBase.classList.add('error');
                lineaBaseError.textContent = 'Formato requerido: número 0-100 con % (ej: 75%)';
                lineaBaseError.style.display = 'block';
                isValid = false;
            } else {
                elaboracionLineaBase.classList.remove('error');
                lineaBaseError.style.display = 'none';
            }
            
            // Validar medio de verificación
            const medioVerificacionRows = medioVerificacionBody.querySelectorAll('tr');
            const medioVerificacionError = document.getElementById('errorMedioVerificacion');
            
            if (medioVerificacionRows.length === 0) {
                medioVerificacionError.style.display = 'block';
                isValid = false;
            } else {
                // Verificar que al menos una fila tenga datos
                let hasData = false;
                medioVerificacionRows.forEach(row => {
                    const detalle = row.querySelector('input[type="text"]').value.trim();
                    const plazo = row.querySelector('select').value;
                    if (detalle || plazo) {
                        hasData = true;
                    }
                });
                
                if (!hasData) {
                    medioVerificacionError.style.display = 'block';
                    isValid = false;
                } else {
                    medioVerificacionError.style.display = 'none';
                }
            }
            
            // Habilitar o deshabilitar botón de guardar
            const saveBtn = document.getElementById('saveElaboracionBtn');
            saveBtn.disabled = !isValid;
            
            return isValid;
        }
        
        // Event listeners para validación en tiempo real
        const elaboracionFields = [
            elaboracionTema, elaboracionObjetivo, elaboracionPoliticas,
            elaboracionMetas, elaboracionActividades, elaboracionIndicadorResultado,
            elaboracionResponsable, elaboracionFecha
        ];
        
        elaboracionFields.forEach(field => {
            field.addEventListener('input', validateElaboracionForm);
            field.addEventListener('change', validateElaboracionForm);
        });
        
        // Eventos para validar línea base en tiempo real
        elaboracionLineaBase.addEventListener('input', function(e) {
            let valor = this.value;
            
            // Solo permitir números y %
            valor = valor.replace(/[^\d%]/g, '');
            
            // Si hay un %, asegurarse de que esté al final
            if (valor.includes('%') && !valor.endsWith('%')) {
                valor = valor.replace(/%/g, '') + '%';
            }
            
            // Asegurarse de que el número sea 0-100
            const numero = parseInt(valor.replace('%', ''));
            if (!isNaN(numero) && numero > 100) {
                valor = '100%';
            }
            
            this.value = valor;
            validateElaboracionForm();
        });
        
        // Cuando se selecciona un objetivo, se completa automáticamente el eje y se cargan sus indicadores
        elaboracionObjetivo.addEventListener('change', function() {
            const objetivoId = this.value;
            if (objetivoId) {
                // Buscar el eje correspondiente al objetivo seleccionado
                const eje = ejes.find(e => e.id == objetivoId);
                if (eje) {
                    // Establecer el valor del campo de eje
                    elaboracionEje.value = eje.id;
                    
                    // Actualizar las opciones del select para mostrar el nombre correcto
                    const ejeOption = elaboracionEje.querySelector(`option[value="${eje.id}"]`);
                    if (ejeOption) {
                        ejeOption.textContent = eje.nombre;
                    }
                    
                    // Cargar indicadores predefinidos para este eje
                    loadIndicadoresPredeterminados(eje.id);
                    
                    showAlert('info', `Eje "${eje.nombre}" asignado automáticamente`);
                }
            } else {
                // Si no hay objetivo seleccionado, limpiar el campo de eje
                elaboracionEje.value = '';
                const defaultOption = elaboracionEje.querySelector('option[value=""]');
                if (defaultOption) {
                    defaultOption.textContent = '-- Se completará automáticamente --';
                }
                
                // Limpiar indicadores
                indicadoresPredeterminadosContainer.innerHTML = '';
                selectedIndicador = null;
                elaboracionIndicador.value = '';
            }
            validateElaboracionForm();
        });
        
        // ==================== FUNCIONES PARA CARGAR DATOS CON PAGINACIÓN Y BÚSQUEDA ====================
        
        // Load users for coordination page
        function loadUsers(page = currentUsersPage, searchTerm = currentUsersSearch) {
            // Filtrar usuarios
            let filteredUsers = users;
            if (searchTerm) {
                filteredUsers = filterData(users, searchTerm, ['username']);
                currentUsersSearch = searchTerm;
            }
            
            // Paginar usuarios
            const perPage = parseInt(usersPerPage.value) || 10;
            const paginated = paginateData(filteredUsers, page, perPage);
            currentUsersPage = page;
            
            // Renderizar usuarios
            usersGrid.innerHTML = '';
            
            if (paginated.items.length === 0) {
                usersGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>${searchTerm ? 'No se encontraron usuarios con ese criterio de búsqueda' : 'No hay usuarios registrados'}</p>
                    </div>
                `;
            } else {
                paginated.items.forEach(user => {
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    userCard.innerHTML = `
                        <div class="user-card-header">
                            <div class="user-name">${user.username}</div>
                            <div class="user-actions">
                                <button class="btn btn-danger btn-sm delete-user" data-id="${user.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="user-details">
                            ID: ${user.id}
                        </div>
                    `;
                    
                    usersGrid.appendChild(userCard);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-user').forEach(button => {
                    button.addEventListener('click', function() {
                        const userId = parseInt(this.getAttribute('data-id'));
                        deleteUser(userId);
                    });
                });
            }
            
            // Crear paginación
            createPaginationControls({
                totalPages: paginated.totalPages,
                currentPage: page,
                totalItems: paginated.totalItems,
                perPage: perPage
            }, 'usersPagination', (newPage) => {
                loadUsers(newPage, currentUsersSearch);
            });
        }
        
        // Load plans for plan operativo page
        function loadPlans(page = currentPlansPage, searchTerm = currentPlansSearch) {
            // Filtrar planes
            let filteredPlans = plans;
            if (searchTerm) {
                filteredPlans = filterData(plans, searchTerm, ['elaborado', 'responsable', 'estado']);
                currentPlansSearch = searchTerm;
            }
            
            // Paginar planes
            const perPage = parseInt(plansPerPage.value) || 10;
            const paginated = paginateData(filteredPlans, page, perPage);
            currentPlansPage = page;
            
            // Renderizar tabla
            planTableBody.innerHTML = '';
            
            if (paginated.items.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="8" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-clipboard-list" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>${searchTerm ? 'No se encontraron planes con ese criterio de búsqueda' : 'No hay planes registrados'}</p>
                    </td>
                `;
                planTableBody.appendChild(row);
            } else {
                paginated.items.forEach(plan => {
                    // Determinar estado del plan
                    let estadoText = '';
                    let estadoClass = '';
                    
                    if (plan.estado === "completado") {
                        estadoText = 'Completado';
                        estadoClass = 'status-completado';
                    } else if (plan.estado === "en proceso") {
                        estadoText = 'En Proceso';
                        estadoClass = 'status-pendiente';
                    } else {
                        estadoText = 'Pendiente';
                        estadoClass = 'status-incompleto';
                    }
                    
                    // Crear contenido detallado para la columna de estado
                    let estadoDetalleHTML = `
                        <div class="estado-detalle">
                            <div class="estado-item">
                                <span class="estado-icon ${plan.elaboracion.estado ? 'estado-completado' : 'estado-incompleto'}">
                                    ${plan.elaboracion.estado ? '✓' : '✗'}
                                </span>
                                <span>Elaboración</span>
                            </div>
                            <div class="estado-item">
                                <span class="estado-icon ${plan.seguimiento.estado ? 'estado-completado' : 'estado-incompleto'}">
                                    ${plan.seguimiento.estado ? '✓' : '✗'}
                                </span>
                                <span>Seguimiento</span>
                            </div>
                            <div class="estado-item">
                                <span class="estado-icon ${plan.ejecucion.estado ? 'estado-completado' : 'estado-incompleto'}">
                                    ${plan.ejecucion.estado ? '✓' : '✗'}
                                </span>
                                <span>Ejecución</span>
                            </div>
                        </div>
                    `;
                    
                    // Crear botones con checks
                    const elaboracionBtnHTML = plan.elaboracion.estado ? 
                        `<div class="button-with-check">
                            <span class="check-badge"><i class="fas fa-check"></i></span>
                            <button class="btn btn-primary btn-sm col-button edit-elaboracion" data-plan="${plan.id}">
                                <i class="fas fa-edit"></i> Elaboración
                            </button>
                        </div>` :
                        `<button class="btn btn-primary btn-sm col-button edit-elaboracion" data-plan="${plan.id}">
                            <i class="fas fa-edit"></i> Elaboración
                        </button>`;
                    
                    const seguimientoBtnHTML = plan.seguimiento.estado ? 
                        `<div class="button-with-check">
                            <span class="check-badge"><i class="fas fa-check"></i></span>
                            <button class="btn btn-warning btn-sm col-button edit-seguimiento" data-plan="${plan.id}" ${!plan.elaboracion.estado ? 'disabled' : ''}>
                                <i class="fas fa-chart-line"></i> Seguimiento
                            </button>
                        </div>` :
                        `<button class="btn btn-warning btn-sm col-button edit-seguimiento" data-plan="${plan.id}" ${!plan.elaboracion.estado ? 'disabled' : ''}>
                            <i class="fas fa-chart-line"></i> Seguimiento
                        </button>`;
                    
                    const ejecucionBtnHTML = plan.ejecucion.estado ? 
                        `<div class="button-with-check">
                            <span class="check-badge"><i class="fas fa-check"></i></span>
                            <button class="btn btn-info btn-sm col-button upload-file" data-plan="${plan.id}" ${!plan.elaboracion.estado ? 'disabled' : ''}>
                                <i class="fas fa-upload"></i> Ejecución
                            </button>
                        </div>` :
                        `<button class="btn btn-info btn-sm col-button upload-file" data-plan="${plan.id}" ${!plan.elaboracion.estado ? 'disabled' : ''}>
                            <i class="fas fa-upload"></i> Ejecución
                        </button>`;
                    
                    // Botón para imprimir solo si el plan está completado
                    const imprimirBtnHTML = plan.estado === "completado" ? 
                        `<button class="btn btn-success btn-sm col-button imprimir-plan" data-plan="${plan.id}">
                            <i class="fas fa-print"></i> Imprimir/PDF
                        </button>` : '';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${plan.id}</td>
                        <td>${plan.elaborado}</td>
                        <td>${plan.responsable}</td>
                        <td>
                            <span class="plan-status ${estadoClass}">${estadoText}</span>
                            ${estadoDetalleHTML}
                        </td>
                        <td class="elaboracion-col">
                            ${elaboracionBtnHTML}
                        </td>
                        <td class="seguimiento-col">
                            ${seguimientoBtnHTML}
                        </td>
                        <td class="ejecucion-col">
                            ${ejecucionBtnHTML}
                        </td>
                        <td class="acciones-col">
                            ${imprimirBtnHTML}
                            <button class="btn btn-danger btn-sm col-button delete-plan" data-id="${plan.id}">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    `;
                    
                    planTableBody.appendChild(row);
                });
                
                // Add event listeners to elaboracion edit buttons
                document.querySelectorAll('.edit-elaboracion').forEach(button => {
                    button.addEventListener('click', function() {
                        const planId = parseInt(this.getAttribute('data-plan'));
                        openElaboracionModal(planId);
                    });
                });
                
                // Add event listeners to seguimiento edit buttons
                document.querySelectorAll('.edit-seguimiento').forEach(button => {
                    button.addEventListener('click', function() {
                        const planId = parseInt(this.getAttribute('data-plan'));
                        openSeguimientoModal(planId);
                    });
                });
                
                // Add event listeners to upload file buttons
                document.querySelectorAll('.upload-file').forEach(button => {
                    button.addEventListener('click', function() {
                        const planId = parseInt(this.getAttribute('data-plan'));
                        openEjecucionModal(planId);
                    });
                });
                
                // Add event listeners to print buttons
                document.querySelectorAll('.imprimir-plan').forEach(button => {
                    button.addEventListener('click', function() {
                        const planId = parseInt(this.getAttribute('data-plan'));
                        openElaboracionModal(planId);
                        // Cambiar a pestaña de imprimir
                        setTimeout(() => {
                            document.querySelector('.tab-btn[data-tab="imprimir"]').click();
                        }, 100);
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-plan').forEach(button => {
                    button.addEventListener('click', function() {
                        const planId = parseInt(this.getAttribute('data-id'));
                        deletePlan(planId);
                    });
                });
            }
            
            // Crear paginación
            createPaginationControls({
                totalPages: paginated.totalPages,
                currentPage: page,
                totalItems: paginated.totalItems,
                perPage: perPage
            }, 'plansPagination', (newPage) => {
                loadPlans(newPage, currentPlansSearch);
            });
        }
        
        // Load temas for tema poa page
        function loadTemas(page = currentTemasPage, searchTerm = currentTemasSearch) {
            // Filtrar temas
            let filteredTemas = temas;
            if (searchTerm) {
                filteredTemas = filterData(temas, searchTerm, ['nombre']);
                currentTemasSearch = searchTerm;
            }
            
            // Paginar temas
            const perPage = parseInt(temasPerPage.value) || 10;
            const paginated = paginateData(filteredTemas, page, perPage);
            currentTemasPage = page;
            
            // Renderizar tabla
            temaTableBody.innerHTML = '';
            
            if (paginated.items.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="3" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-folder" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>${searchTerm ? 'No se encontraron temas con ese criterio de búsqueda' : 'No hay temas registrados'}</p>
                    </td>
                `;
                temaTableBody.appendChild(row);
            } else {
                paginated.items.forEach(tema => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${tema.id}</td>
                        <td>${tema.nombre}</td>
                        <td>
                            <button class="btn btn-danger btn-sm delete-tema" data-id="${tema.id}">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    `;
                    
                    temaTableBody.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-tema').forEach(button => {
                    button.addEventListener('click', function() {
                        const temaId = parseInt(this.getAttribute('data-id'));
                        deleteTema(temaId);
                    });
                });
            }
            
            // Crear paginación
            createPaginationControls({
                totalPages: paginated.totalPages,
                currentPage: page,
                totalItems: paginated.totalItems,
                perPage: perPage
            }, 'temasPagination', (newPage) => {
                loadTemas(newPage, currentTemasSearch);
            });
        }
        
        // Load ejes for eje objetivo page
        function loadEjes(page = currentEjesPage, searchTerm = currentEjesSearch) {
            // Filtrar ejes
            let filteredEjes = ejes;
            if (searchTerm) {
                filteredEjes = filterData(ejes, searchTerm, ['nombre', 'objetivo']);
                currentEjesSearch = searchTerm;
            }
            
            // Paginar ejes
            const perPage = parseInt(ejesPerPage.value) || 10;
            const paginated = paginateData(filteredEjes, page, perPage);
            currentEjesPage = page;
            
            // Renderizar tabla
            ejeTableBody.innerHTML = '';
            
            if (paginated.items.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-bullseye" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>${searchTerm ? 'No se encontraron ejes con ese criterio de búsqueda' : 'No hay ejes registrados'}</p>
                    </td>
                `;
                ejeTableBody.appendChild(row);
            } else {
                paginated.items.forEach(eje => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${eje.id}</td>
                        <td>${eje.nombre}</td>
                        <td>${eje.objetivo.length > 100 ? eje.objetivo.substring(0, 100) + '...' : eje.objetivo}</td>
                        <td>
                            <button class="btn btn-primary btn-sm edit-eje" data-id="${eje.id}">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-danger btn-sm delete-eje" data-id="${eje.id}">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    `;
                    
                    ejeTableBody.appendChild(row);
                });
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-eje').forEach(button => {
                    button.addEventListener('click', function() {
                        const ejeId = parseInt(this.getAttribute('data-id'));
                        openEditEjeModal(ejeId);
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-eje').forEach(button => {
                    button.addEventListener('click', function() {
                        const ejeId = parseInt(this.getAttribute('data-id'));
                        deleteEje(ejeId);
                    });
                });
            }
            
            // Crear paginación
            createPaginationControls({
                totalPages: paginated.totalPages,
                currentPage: page,
                totalItems: paginated.totalItems,
                perPage: perPage
            }, 'ejesPagination', (newPage) => {
                loadEjes(newPage, currentEjesSearch);
            });
        }
        
        // Load plazos for plazo page
        function loadPlazos(page = currentPlazosPage, searchTerm = currentPlazosSearch) {
            // Filtrar plazos
            let filteredPlazos = plazos;
            if (searchTerm) {
                filteredPlazos = filterData(plazos, searchTerm, ['nombre']);
                currentPlazosSearch = searchTerm;
            }
            
            // Paginar plazos
            const perPage = parseInt(plazosPerPage.value) || 10;
            const paginated = paginateData(filteredPlazos, page, perPage);
            currentPlazosPage = page;
            
            // Renderizar tabla
            plazoTableBody.innerHTML = '';
            
            if (paginated.items.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="3" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-calendar-alt" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>${searchTerm ? 'No se encontraron plazos con ese criterio de búsqueda' : 'No hay plazos registrados'}</p>
                    </td>
                `;
                plazoTableBody.appendChild(row);
            } else {
                paginated.items.forEach(plazo => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${plazo.id}</td>
                        <td>${plazo.nombre}</td>
                        <td>
                            <button class="btn btn-primary btn-sm edit-plazo" data-id="${plazo.id}">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-danger btn-sm delete-plazo" data-id="${plazo.id}">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    `;
                    
                    plazoTableBody.appendChild(row);
                });
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-plazo').forEach(button => {
                    button.addEventListener('click', function() {
                        const plazoId = parseInt(this.getAttribute('data-id'));
                        openEditPlazoModal(plazoId);
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-plazo').forEach(button => {
                    button.addEventListener('click', function() {
                        const plazoId = parseInt(this.getAttribute('data-id'));
                        deletePlazo(plazoId);
                    });
                });
            }
            
            // Crear paginación
            createPaginationControls({
                totalPages: paginated.totalPages,
                currentPage: page,
                totalItems: paginated.totalItems,
                perPage: perPage
            }, 'plazosPagination', (newPage) => {
                loadPlazos(newPage, currentPlazosSearch);
            });
        }
        
        // Load responsables for responsable page
        function loadResponsables(page = currentResponsablesPage, searchTerm = currentResponsablesSearch) {
            // Filtrar responsables
            let filteredResponsables = responsables;
            if (searchTerm) {
                filteredResponsables = filterData(responsables, searchTerm, ['nombre']);
                currentResponsablesSearch = searchTerm;
            }
            
            // Paginar responsables
            const perPage = parseInt(responsablesPerPage.value) || 10;
            const paginated = paginateData(filteredResponsables, page, perPage);
            currentResponsablesPage = page;
            
            // Renderizar tabla
            responsableTableBody.innerHTML = '';
            
            if (paginated.items.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="3" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-user-tie" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>${searchTerm ? 'No se encontraron responsables con ese criterio de búsqueda' : 'No hay responsables registrados'}</p>
                    </td>
                `;
                responsableTableBody.appendChild(row);
            } else {
                paginated.items.forEach(responsable => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${responsable.id}</td>
                        <td>${responsable.nombre}</td>
                        <td>
                            <button class="btn btn-primary btn-sm edit-responsable" data-id="${responsable.id}">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-danger btn-sm delete-responsable" data-id="${responsable.id}">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    `;
                    
                    responsableTableBody.appendChild(row);
                });
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-responsable').forEach(button => {
                    button.addEventListener('click', function() {
                        const responsableId = parseInt(this.getAttribute('data-id'));
                        openEditResponsableModal(responsableId);
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-responsable').forEach(button => {
                    button.addEventListener('click', function() {
                        const responsableId = parseInt(this.getAttribute('data-id'));
                        deleteResponsable(responsableId);
                    });
                });
            }
            
            // Crear paginación
            createPaginationControls({
                totalPages: paginated.totalPages,
                currentPage: page,
                totalItems: paginated.totalItems,
                perPage: perPage
            }, 'responsablesPagination', (newPage) => {
                loadResponsables(newPage, currentResponsablesSearch);
            });
        }
        
        // ==================== FUNCIONES PARA MODALES ====================
        
        // Open elaboracion modal - CORREGIDO
        function openElaboracionModal(planId) {
            const plan = plans.find(p => p.id === planId);
            if (!plan) return;
            
            currentPlanId = planId;
            selectedIndicador = null;
            
            // Load custom selects
            loadCustomSelects();
            
            // Set plan data
            elaboracionNombreElaborado.value = plan.elaborado;
            elaboracionNombreResponsable.value = plan.responsable;
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            elaboracionFecha.value = today;
            
            // Clear and load medio de verificación rows
            clearMedioVerificacionRows();
            if (plan.elaboracion.medioVerificacion && plan.elaboracion.medioVerificacion.length > 0) {
                plan.elaboracion.medioVerificacion.forEach(item => {
                    addMedioVerificacionRowFunction(item);
                });
            } else {
                // Add one empty row by default
                addMedioVerificacionRowFunction();
            }
            
            // Set existing elaboracion data if available
            if (plan.elaboracion.estado) {
                elaboracionTema.value = plan.elaboracion.tema;
                elaboracionObjetivo.value = plan.elaboracion.objetivo;
                
                // Si hay un objetivo, buscar y establecer el eje correspondiente
                if (plan.elaboracion.objetivo) {
                    const eje = ejes.find(e => e.id == plan.elaboracion.objetivo);
                    if (eje) {
                        elaboracionEje.value = eje.id;
                        // Actualizar el texto de la opción seleccionada
                        const ejeOption = elaboracionEje.querySelector(`option[value="${eje.id}"]`);
                        if (ejeOption) {
                            ejeOption.textContent = eje.nombre;
                        }
                        
                        // Cargar indicadores predefinidos
                        loadIndicadoresPredeterminados(eje.id);
                        
                        // CORRECCIÓN: Buscar y seleccionar el indicador si existe
                        if (plan.elaboracion.indicador) {
                            // Esperar a que se carguen los indicadores
                            setTimeout(() => {
                                const indicadorElements = document.querySelectorAll('.indicador-predeterminado');
                                indicadorElements.forEach(el => {
                                    const codigoElement = el.querySelector('div strong');
                                    if (codigoElement && codigoElement.textContent === plan.elaboracion.indicador) {
                                        el.classList.add('selected');
                                        selectedIndicador = {
                                            codigo: plan.elaboracion.indicador,
                                            descripcion: plan.elaboracion.descripcionIndicador || ""
                                        };
                                        elaboracionIndicador.value = plan.elaboracion.indicador;
                                    }
                                });
                                
                                // Si no se encontró en los predefinidos, permitir el valor manual
                                if (!selectedIndicador && plan.elaboracion.indicador) {
                                    elaboracionIndicador.value = plan.elaboracion.indicador;
                                }
                            }, 100);
                        }
                    }
                }
                
                elaboracionItemTitulo.textContent = plan.elaboracion.item;
                elaboracionLineaBase.value = plan.elaboracion.lineaBase;
                elaboracionPoliticas.value = plan.elaboracion.politicas;
                elaboracionMetas.value = plan.elaboracion.metas;
                elaboracionActividades.value = plan.elaboracion.actividades;
                elaboracionIndicadorResultado.value = plan.elaboracion.indicadorResultado;
                elaboracionResponsable.value = plan.elaboracion.responsable;
                elaboracionFecha.value = plan.elaboracion.fecha || today;
            } else {
                // Clear form if no elaboracion data exists
                clearElaboracionForm();
            }
            
            // Generar vista previa de impresión
            printPreviewContainer.innerHTML = generatePrintPreview(planId);
            
            // Actualizar estado de botones de impresión
            updatePrintButtonsState(planId);
            
            // Validar formulario inicialmente
            validateElaboracionForm();
            
            // Asegurarse de que la pestaña de formulario esté activa
            tabBtns.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            document.querySelector('.tab-btn[data-tab="formulario"]').classList.add('active');
            document.getElementById('tab-formulario').classList.add('active');
            
            openModal(elaboracionModal);
        }
        
        // Open seguimiento modal
        function openSeguimientoModal(planId) {
            const plan = plans.find(p => p.id === planId);
            if (!plan) return;
            
            currentPlanId = planId;
            
            // Load plan data (solo lectura)
            seguimientoTema.value = temas.find(t => t.id == plan.elaboracion.tema)?.nombre || '';
            seguimientoObjetivo.value = ejes.find(e => e.id == plan.elaboracion.objetivo)?.objetivo || '';
            seguimientoEje.value = ejes.find(e => e.id == plan.elaboracion.eje)?.nombre || '';
            seguimientoItemTitulo.textContent = plan.elaboracion.item;
            seguimientoIndicador.value = plan.elaboracion.indicador;
            seguimientoLineaBase.value = plan.elaboracion.lineaBase;
            seguimientoPoliticas.value = plan.elaboracion.politicas;
            seguimientoMetas.value = plan.elaboracion.metas;
            seguimientoActividades.value = plan.elaboracion.actividades;
            seguimientoIndicadorResultado.value = plan.elaboracion.indicadorResultado;
            seguimientoResponsable.value = responsables.find(r => r.id == plan.elaboracion.responsable)?.nombre || '';
            seguimientoNombreElaborado.value = plan.elaborado;
            seguimientoNombreResponsable.value = plan.responsable;
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            seguimientoFecha.value = today;
            
            // Clear and load medio de verificación rows para seguimiento
            seguimientoMedioVerificacionBody.innerHTML = '';
            
            if (plan.elaboracion.medioVerificacion && plan.elaboracion.medioVerificacion.length > 0) {
                plan.elaboracion.medioVerificacion.forEach((item, index) => {
                    addSeguimientoMedioVerificacionRow(item, index);
                });
            }
            
            // Si ya hay datos de seguimiento, cargarlos
            if (plan.seguimiento.estado && plan.seguimiento.cumplimiento) {
                plan.seguimiento.cumplimiento.forEach((item, index) => {
                    const row = seguimientoMedioVerificacionBody.querySelectorAll('tr')[index];
                    if (row) {
                        row.querySelector('.cumplimiento-select').value = item.cumplimiento;
                        row.querySelector('.observaciones-input').value = item.observaciones;
                    }
                });
                seguimientoFecha.value = plan.seguimiento.fecha || today;
            }
            
            openModal(seguimientoModal);
        }
        
        // Open ejecucion modal
        function openEjecucionModal(planId) {
            const plan = plans.find(p => p.id === planId);
            if (!plan) return;
            
            currentPlanId = planId;
            currentEjecucionFiles = [...plan.ejecucion.archivos];
            
            // Set plan title
            ejecucionPlanTitle.textContent = `${plan.elaborado} - ${plan.responsable}`;
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            ejecucionFecha.value = today;
            
            // Clear and display uploaded files
            uploadedFiles.innerHTML = '';
            currentEjecucionFiles.forEach(file => {
                displayUploadedFile(file);
            });
            
            // Si ya hay fecha de ejecución, cargarla
            if (plan.ejecucion.estado && plan.ejecucion.fecha) {
                ejecucionFecha.value = plan.ejecucion.fecha;
            }
            
            openModal(ejecucionModal);
        }
        
        // Open edit eje modal
        function openEditEjeModal(ejeId) {
            const eje = ejes.find(e => e.id === ejeId);
            if (!eje) return;
            
            editEjeModal.setAttribute('data-eje-id', ejeId);
            document.getElementById('editEjeName').value = eje.nombre;
            document.getElementById('editObjetivoDesc').value = eje.objetivo;
            openModal(editEjeModal);
        }
        
        // Open edit plazo modal
        function openEditPlazoModal(plazoId) {
            const plazo = plazos.find(p => p.id === plazoId);
            if (!plazo) return;
            
            editPlazoModal.setAttribute('data-plazo-id', plazoId);
            document.getElementById('editPlazoName').value = plazo.nombre;
            openModal(editPlazoModal);
        }
        
        // Open edit responsable modal
        function openEditResponsableModal(responsableId) {
            const responsable = responsables.find(r => r.id === responsableId);
            if (!responsable) return;
            
            editResponsableModal.setAttribute('data-responsable-id', responsableId);
            document.getElementById('editResponsableNombre').value = responsable.nombre;
            openModal(editResponsableModal);
        }
        
        // ==================== FUNCIONES DE GUARDADO ====================
        
        // Save Elaboracion functionality - CORREGIDO
        saveElaboracionBtn.addEventListener('click', function() {
            if (!validateElaboracionForm()) {
                showAlert('warning', 'Por favor complete todos los campos obligatorios');
                return;
            }
            
            const planIndex = plans.findIndex(p => p.id === currentPlanId);
            
            if (planIndex !== -1) {
                // Recopilar datos de medio de verificación
                const medioVerificacionData = [];
                const rows = medioVerificacionBody.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const detalle = row.querySelector('input[type="text"]').value;
                    const plazo = row.querySelector('select').value;
                    
                    if (detalle || plazo) {
                        medioVerificacionData.push({
                            detalle: detalle,
                            plazo: plazo
                        });
                    }
                });
                
                // CORRECCIÓN: Obtener descripción del indicador seleccionado
                let descripcionIndicador = "";
                if (selectedIndicador) {
                    descripcionIndicador = selectedIndicador.descripcion;
                } else {
                    // Buscar en todos los ejes si el indicador existe
                    const indicadorCodigo = elaboracionIndicador.value.trim();
                    for (const eje of ejes) {
                        if (eje.indicadores) {
                            const indicadorEncontrado = eje.indicadores.find(ind => ind.codigo === indicadorCodigo);
                            if (indicadorEncontrado) {
                                descripcionIndicador = indicadorEncontrado.descripcion;
                                break;
                            }
                        }
                    }
                }
                
                // Update plan elaboracion data
                plans[planIndex].elaboracion = {
                    estado: true,
                    contenido: "Información de elaboración completada",
                    tema: elaboracionTema.value,
                    objetivo: elaboracionObjetivo.value,
                    eje: elaboracionEje.value,
                    item: "ITEM DESCRIPCIÓN",
                    indicador: elaboracionIndicador.value.trim(),
                    descripcionIndicador: descripcionIndicador,
                    lineaBase: elaboracionLineaBase.value,
                    politicas: elaboracionPoliticas.value,
                    metas: elaboracionMetas.value,
                    actividades: elaboracionActividades.value,
                    indicadorResultado: elaboracionIndicadorResultado.value,
                    medioVerificacion: medioVerificacionData,
                    responsable: elaboracionResponsable.value,
                    fecha: elaboracionFecha.value
                };
                
                // Actualizar estado del plan
                plans[planIndex].estado = "en proceso";
                
                loadPlans(currentPlansPage, currentPlansSearch);
                closeModal(elaboracionModal);
                showAlert('success', 'Información de elaboración guardada exitosamente');
                
                // Actualizar dashboard si está activo
                if (document.getElementById('dashboard').style.display === 'block') {
                    updateDashboardStats();
                }
            }
        });
        
        // Save Seguimiento functionality
        saveSeguimientoBtn.addEventListener('click', function() {
            const planIndex = plans.findIndex(p => p.id === currentPlanId);
            
            if (planIndex !== -1) {
                // Recopilar datos de cumplimiento
                const cumplimientoData = [];
                const rows = seguimientoMedioVerificacionBody.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const detalle = row.querySelector('.detalle-text').textContent;
                    const plazo = row.querySelector('.plazo-text').textContent;
                    const cumplimiento = row.querySelector('.cumplimiento-select').value;
                    const observaciones = row.querySelector('.observaciones-input').value;
                    
                    cumplimientoData.push({
                        detalle: detalle,
                        plazo: plazo,
                        cumplimiento: cumplimiento,
                        observaciones: observaciones
                    });
                });
                
                // Update plan seguimiento data
                plans[planIndex].seguimiento = {
                    estado: true,
                    contenido: "Seguimiento completado",
                    cumplimiento: cumplimientoData,
                    fecha: seguimientoFecha.value
                };
                
                // Actualizar estado del plan si todos los procesos están completos
                if (plans[planIndex].elaboracion.estado && plans[planIndex].seguimiento.estado && plans[planIndex].ejecucion.estado) {
                    plans[planIndex].estado = "completado";
                } else {
                    plans[planIndex].estado = "en proceso";
                }
                
                loadPlans(currentPlansPage, currentPlansSearch);
                closeModal(seguimientoModal);
                showAlert('success', 'Seguimiento guardado exitosamente');
                
                // Actualizar dashboard si está activo
                if (document.getElementById('dashboard').style.display === 'block') {
                    updateDashboardStats();
                }
            }
        });
        
        // Save Ejecucion functionality
        saveEjecucionBtn.addEventListener('click', function() {
            const planIndex = plans.findIndex(p => p.id === currentPlanId);
            
            if (planIndex !== -1) {
                // Update plan ejecucion data
                plans[planIndex].ejecucion = {
                    estado: currentEjecucionFiles.length > 0,
                    contenido: "Documentos de ejecución subidos",
                    archivos: [...currentEjecucionFiles],
                    fecha: ejecucionFecha.value
                };
                
                // Actualizar estado del plan si todos los procesos están completos
                if (plans[planIndex].elaboracion.estado && plans[planIndex].seguimiento.estado && plans[planIndex].ejecucion.estado) {
                    plans[planIndex].estado = "completado";
                } else {
                    plans[planIndex].estado = "en proceso";
                }
                
                loadPlans(currentPlansPage, currentPlansSearch);
                closeModal(ejecucionModal);
                showAlert('success', 'Documentos de ejecución guardados exitosamente');
                
                // Actualizar dashboard si está activo
                if (document.getElementById('dashboard').style.display === 'block') {
                    updateDashboardStats();
                }
            }
        });
        
        // ==================== FUNCIONES AUXILIARES ====================
        
        // Función para agregar filas de medio de verificación en seguimiento
        function addSeguimientoMedioVerificacionRow(data, index) {
            const plazoNombre = plazos.find(p => p.id == data.plazo)?.nombre || data.plazo;
            const cumplimientoValue = data.cumplimiento || '';
            const observacionesValue = data.observaciones || '';
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <span class="detalle-text">${data.detalle}</span>
                </td>
                <td>
                    <span class="plazo-text">${plazoNombre}</span>
                </td>
                <td>
                    <div class="custom-select cumplimiento-select">
                        <select class="${cumplimientoValue === 'si' ? 'cumplimiento-si' : cumplimientoValue === 'no' ? 'cumplimiento-no' : ''}">
                            <option value="">-- Seleccione --</option>
                            <option value="si" ${cumplimientoValue === 'si' ? 'selected' : ''}>Sí Cumple</option>
                            <option value="no" ${cumplimientoValue === 'no' ? 'selected' : ''}>No Cumple</option>
                        </select>
                    </div>
                </td>
                <td>
                    <input type="text" class="form-control observaciones-input" value="${observacionesValue}" placeholder="Observaciones">
                </td>
            `;
            
            seguimientoMedioVerificacionBody.appendChild(row);
            
            // Agregar evento para cambiar clase según cumplimiento
            const select = row.querySelector('.cumplimiento-select select');
            select.addEventListener('change', function() {
                if (this.value === 'si') {
                    this.classList.remove('cumplimiento-no');
                    this.classList.add('cumplimiento-si');
                } else if (this.value === 'no') {
                    this.classList.remove('cumplimiento-si');
                    this.classList.add('cumplimiento-no');
                } else {
                    this.classList.remove('cumplimiento-si', 'cumplimiento-no');
                }
            });
        }
        
        // Medio de Verificación functionality
        addMedioVerificacionRow.addEventListener('click', function() {
            addMedioVerificacionRowFunction();
            validateElaboracionForm();
        });
        
        function addMedioVerificacionRowFunction(data = { detalle: '', plazo: '' }) {
            medioVerificacionRowCounter++;
            const rowId = `medioVerificacionRow_${medioVerificacionRowCounter}`;
            
            const row = document.createElement('tr');
            row.id = rowId;
            row.innerHTML = `
                <td>
                    <input type="text" class="form-control" value="${data.detalle}" placeholder="Ingrese el detalle">
                </td>
                <td>
                    <div class="custom-select">
                        <select>
                            <option value="">-- Seleccione --</option>
                            ${plazos.map(plazo => 
                                `<option value="${plazo.id}" ${data.plazo == plazo.id ? 'selected' : ''}>${plazo.nombre}</option>`
                            ).join('')}
                        </select>
                    </div>
                </td>
                <td>
                    <button class="btn btn-danger btn-xs remove-medio-verificacion-row" data-row="${rowId}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            
            medioVerificacionBody.appendChild(row);
            
            // Add event listeners
            const input = row.querySelector('input[type="text"]');
            const select = row.querySelector('select');
            
            input.addEventListener('input', validateElaboracionForm);
            select.addEventListener('change', validateElaboracionForm);
            
            // Add event listener to remove button
            row.querySelector('.remove-medio-verificacion-row').addEventListener('click', function() {
                const rowToRemove = document.getElementById(this.getAttribute('data-row'));
                if (rowToRemove) {
                    rowToRemove.remove();
                    validateElaboracionForm();
                }
            });
        }
        
        function clearMedioVerificacionRows() {
            medioVerificacionBody.innerHTML = '';
            medioVerificacionRowCounter = 0;
        }
        
        // Clear elaboracion form
        function clearElaboracionForm() {
            elaboracionTema.value = '';
            elaboracionObjetivo.value = '';
            elaboracionEje.value = '';
            
            // Restaurar texto por defecto en el campo de eje
            const defaultOption = elaboracionEje.querySelector('option[value=""]');
            if (defaultOption) {
                defaultOption.textContent = '-- Se completará automáticamente --';
            }
            
            elaboracionItemTitulo.textContent = "ITEM DESCRIPCIÓN";
            elaboracionIndicador.value = '';
            indicadoresPredeterminadosContainer.innerHTML = '';
            selectedIndicador = null;
            elaboracionLineaBase.value = '';
            elaboracionPoliticas.value = '';
            elaboracionMetas.value = '';
            elaboracionActividades.value = '';
            elaboracionIndicadorResultado.value = '';
            elaboracionResponsable.value = '';
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            elaboracionFecha.value = today;
        }
        
        // ==================== FUNCIONES DE ELIMINACIÓN ====================
        
        // Delete user function
        function deleteUser(userId) {
            if (confirm('¿Está seguro de que desea eliminar este usuario?')) {
                const index = users.findIndex(u => u.id === userId);
                if (index !== -1) {
                    users.splice(index, 1);
                    // Reasignar IDs
                    users.forEach((user, idx) => {
                        user.id = idx + 1;
                    });
                    loadUsers(currentUsersPage, currentUsersSearch);
                    showAlert('success', 'Usuario eliminado exitosamente');
                    
                    // Actualizar dashboard si está activo
                    if (document.getElementById('dashboard').style.display === 'block') {
                        updateDashboardStats();
                    }
                }
            }
        }
        
        // Delete plan function
        function deletePlan(planId) {
            if (confirm('¿Está seguro de que desea eliminar este plan?')) {
                const index = plans.findIndex(p => p.id === planId);
                if (index !== -1) {
                    plans.splice(index, 1);
                    // Reasignar IDs
                    plans.forEach((plan, idx) => {
                        plan.id = idx + 1;
                    });
                    loadPlans(currentPlansPage, currentPlansSearch);
                    showAlert('success', 'Plan eliminado exitosamente');
                    
                    // Actualizar dashboard si está activo
                    if (document.getElementById('dashboard').style.display === 'block') {
                        updateDashboardStats();
                    }
                }
            }
        }
        
        // Delete tema function
        function deleteTema(temaId) {
            if (confirm('¿Está seguro de que desea eliminar este tema?')) {
                const index = temas.findIndex(t => t.id === temaId);
                if (index !== -1) {
                    temas.splice(index, 1);
                    // Reasignar IDs
                    temas.forEach((tema, idx) => {
                        tema.id = idx + 1;
                    });
                    loadTemas(currentTemasPage, currentTemasSearch);
                    showAlert('success', 'Tema eliminado exitosamente');
                }
            }
        }
        
        // Delete eje function
        function deleteEje(ejeId) {
            if (confirm('¿Está seguro de que desea eliminar este eje y objetivo?')) {
                const index = ejes.findIndex(e => e.id === ejeId);
                if (index !== -1) {
                    ejes.splice(index, 1);
                    // Reasignar IDs
                    ejes.forEach((eje, idx) => {
                        eje.id = idx + 1;
                    });
                    loadEjes(currentEjesPage, currentEjesSearch);
                    showAlert('success', 'Eje y Objetivo eliminado exitosamente');
                    
                    // Actualizar dashboard si está activo
                    if (document.getElementById('dashboard').style.display === 'block') {
                        updateDashboardStats();
                    }
                }
            }
        }
        
        // Delete plazo function
        function deletePlazo(plazoId) {
            if (confirm('¿Está seguro de que desea eliminar este plazo?')) {
                const index = plazos.findIndex(p => p.id === plazoId);
                if (index !== -1) {
                    plazos.splice(index, 1);
                    // Reasignar IDs
                    plazos.forEach((plazo, idx) => {
                        plazo.id = idx + 1;
                    });
                    loadPlazos(currentPlazosPage, currentPlazosSearch);
                    showAlert('success', 'Plazo eliminado exitosamente');
                }
            }
        }
        
        // Delete responsable function
        function deleteResponsable(responsableId) {
            if (confirm('¿Está seguro de que desea eliminar este responsable?')) {
                const index = responsables.findIndex(r => r.id === responsableId);
                if (index !== -1) {
                    responsables.splice(index, 1);
                    // Reasignar IDs
                    responsables.forEach((responsable, idx) => {
                        responsable.id = idx + 1;
                    });
                    loadResponsables(currentResponsablesPage, currentResponsablesSearch);
                    showAlert('success', 'Responsable eliminado exitosamente');
                }
            }
        }
        
        // ==================== FUNCIONES PARA IMPRESIÓN Y PDF ====================
        
        // Función para generar vista previa de impresión
        function generatePrintPreview(planId) {
            const plan = plans.find(p => p.id === planId);
            if (!plan) return '';
            
            const temaNombre = temas.find(t => t.id == plan.elaboracion.tema)?.nombre || plan.elaboracion.tema;
            const ejeNombre = ejes.find(e => e.id == plan.elaboracion.eje)?.nombre || plan.elaboracion.eje;
            const objetivoDesc = ejes.find(e => e.id == plan.elaboracion.objetivo)?.objetivo || plan.elaboracion.objetivo;
            const responsableNombre = responsables.find(r => r.id == plan.elaboracion.responsable)?.nombre || plan.elaboracion.responsable;
            
            let medioVerificacionHTML = '';
            if (plan.elaboracion.medioVerificacion && plan.elaboracion.medioVerificacion.length > 0) {
                medioVerificacionHTML = plan.elaboracion.medioVerificacion.map(item => {
                    const plazoNombre = plazos.find(p => p.id == item.plazo)?.nombre || item.plazo;
                    return `<div class="print-field">
                        <div class="print-label">Medio de Verificación:</div>
                        <div class="print-value">${item.detalle || ''} - ${plazoNombre || ''}</div>
                    </div>`;
                }).join('');
            }
            
            const printHTML = `
                <div class="print-preview" id="printContent">
                    <div class="print-header">
                        <h1>PLAN OPERATIVO ANUAL 2024</h1>
                        <p>INSTITUTO SUPERIOR TECNOLÓGICO TURÍSTICO Y PATRIMONIAL YAVIRAC</p>
                        <p style="font-size: 14px; color: #666;">Sistema de Planificación Operativa</p>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <div>
                            <div><strong>Código del Plan:</strong> POA-${plan.id.toString().padStart(3, '0')}</div>
                            <div><strong>Fecha de elaboración:</strong> ${plan.elaboracion.fecha || 'No especificada'}</div>
                        </div>
                        <div style="text-align: right;">
                            <div><strong>Estado:</strong> ${plan.estado.toUpperCase()}</div>
                            <div><strong>Fecha de impresión:</strong> ${new Date().toLocaleDateString()}</div>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 10px;">RESUMEN DEL PLAN</div>
                        <div><strong>Elaborado por:</strong> ${plan.elaborado}</div>
                        <div><strong>Responsable:</strong> ${plan.responsable}</div>
                        <div><strong>Eje:</strong> ${ejeNombre}</div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">TEMA</div>
                        <div class="print-value">${temaNombre}</div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">OBJETIVO</div>
                        <div class="print-value">${objetivoDesc}</div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">EJE</div>
                        <div class="print-value">${ejeNombre}</div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">ITEM DESCRIPCIÓN</div>
                        <div class="print-value">${plan.elaboracion.item || "ITEM DESCRIPCIÓN"}</div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">INDICADOR</div>
                        <div class="print-value">
                            <strong>${plan.elaboracion.indicador || ''}</strong>
                            ${plan.elaboracion.descripcionIndicador ? `<div style="font-size: 12px; color: #666; margin-top: 5px;">${plan.elaboracion.descripcionIndicador}</div>` : ''}
                        </div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">LÍNEA BASE</div>
                        <div class="print-value">${plan.elaboracion.lineaBase || ''}</div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">POLÍTICAS</div>
                        <div class="print-value">${plan.elaboracion.politicas || ''}</div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">METAS</div>
                        <div class="print-value">${plan.elaboracion.metas || ''}</div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">ACTIVIDADES</div>
                        <div class="print-value">${plan.elaboracion.actividades || ''}</div>
                    </div>
                    
                    <div class="print-field">
                        <div class="print-label">INDICADOR DE RESULTADO</div>
                        <div class="print-value">${plan.elaboracion.indicadorResultado || ''}</div>
                    </div>
                    
                    ${medioVerificacionHTML}
                    
                    <div class="print-field">
                        <div class="print-label">RESPONSABLE</div>
                        <div class="print-value">${responsableNombre}</div>
                    </div>
                    
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #000;">
                        <h3 style="text-align: center; margin-bottom: 30px;">FIRMAS DE RESPONSABILIDAD</h3>
                        
                        <div class="firma-section">
                            <div class="firma">
                                <div class="linea-firma"></div>
                                <div class="firma-nombre">${plan.elaborado}</div>
                                <div class="firma-cargo">ELABORADO</div>
                            </div>
                            
                            <div class="firma">
                                <div class="linea-firma"></div>
                                <div class="firma-nombre">${plan.responsable}</div>
                                <div class="firma-cargo">RESPONSABLE DE EJECUCIÓN</div>
                            </div>
                        </div>
                        
                        <div class="firma-section">
                            <div class="firma">
                                <div class="linea-firma"></div>
                                <div class="firma-nombre">ANALIS CANERAL</div>
                                <div class="firma-cargo">COORDINACIÓN DE PLANIFICACIÓN ESTRATÉGICA</div>
                            </div>
                            
                            <div class="firma">
                                <div class="linea-firma"></div>
                                <div class="firma-nombre">DIRECTOR/A DE ÁREA</div>
                                <div class="firma-cargo">UNIDAD RESPONSABLE</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 40px; font-size: 12px; color: #666;">
                            <p>Documento generado automáticamente por el Sistema de Planificación Operativa</p>
                            <p>ISTTP YAVIRAC - ${new Date().getFullYear()}</p>
                        </div>
                    </div>
                </div>
            `;
            
            return printHTML;
        }
        
        // Función para verificar si el plan está completado
        function isPlanCompletado(planId) {
            const plan = plans.find(p => p.id === planId);
            if (!plan) return false;
            
            return plan.estado === "completado";
        }
        
        // Función para actualizar estado de botones de impresión
        function updatePrintButtonsState(planId) {
            const completado = isPlanCompletado(planId);
            
            generarPDFBtn.disabled = !completado;
            imprimirBtn.disabled = !completado;
            
            if (!completado) {
                printPreviewContainer.innerHTML = '<div class="print-preview"><p>El plan debe estar completado (Elaboración, Seguimiento y Ejecución) para poder imprimir o generar PDF.</p></div>';
            }
        }
        
        // Función para generar PDF usando jsPDF
        function generarPDF() {
            if (!currentPlanId) return;
            
            const plan = plans.find(p => p.id === currentPlanId);
            if (!plan) return;
            
            // Verificar si está completado
            if (!isPlanCompletado(currentPlanId)) {
                showAlert('warning', 'El plan debe estar completado para generar PDF');
                return;
            }
            
            // Usar html2canvas para capturar el contenido
            const printContent = document.getElementById('printContent');
            
            if (!printContent) {
                showAlert('danger', 'No se pudo encontrar el contenido para generar PDF');
                return;
            }
            
            showAlert('info', 'Generando PDF, por favor espere...');
            
            html2canvas(printContent, {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
                
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 297; // A4 height in mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Guardar el PDF
                const fileName = `Plan_Operativo_${plan.id}_${plan.elaborado.replace(/\s+/g, '_')}.pdf`;
                pdf.save(fileName);
                
                showAlert('success', 'PDF generado exitosamente');
            }).catch(error => {
                console.error('Error al generar PDF:', error);
                showAlert('danger', 'Error al generar PDF: ' + error.message);
            });
        }
        
        // Función para imprimir
        function imprimirDocumento() {
            if (!currentPlanId) return;
            
            const plan = plans.find(p => p.id === currentPlanId);
            if (!plan) return;
            
            // Verificar si está completado
            if (!isPlanCompletado(currentPlanId)) {
                showAlert('warning', 'El plan debe estar completado para imprimir');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            if (!printWindow) {
                showAlert('warning', 'Por favor permite ventanas emergentes para imprimir');
                return;
            }
            
            const printContent = generatePrintPreview(currentPlanId);
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Plan Operativo ${plan.id} - ${plan.elaborado}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .print-header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 15px; }
                        .print-field { margin-bottom: 15px; }
                        .print-label { font-weight: bold; margin-bottom: 5px; }
                        .print-value { margin-left: 20px; }
                        .firma-section { margin-top: 50px; display: flex; justify-content: space-between; }
                        .firma { text-align: center; width: 45%; }
                        .linea-firma { border-top: 1px solid #000; margin-top: 50px; padding-top: 10px; }
                        @media print {
                            body { margin: 0; padding: 10mm; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    ${printContent}
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() {
                                window.close();
                            }, 1000);
                        };
                    <\/script>
                </body>
                </html>
            `);
            
            printWindow.document.close();
        }
        
        // ==================== FUNCIONES PARA DASHBOARD ====================
        
        // Función para cargar el dashboard
        function loadDashboard() {
            updateDashboardStats();
        }
        
        // Función para calcular estadísticas de uso de ejes
        function calculateEjeUsage() {
            const ejeUsage = {};
            const indicadoresUsage = {};
            
            // Inicializar contadores para cada eje
            ejes.forEach(eje => {
                ejeUsage[eje.id] = {
                    nombre: eje.nombre,
                    objetivo: eje.objetivo,
                    totalPlanes: 0,
                    usuarios: new Set(),
                    indicadoresUtilizados: new Set(),
                    indicadoresDisponibles: eje.indicadores.length,
                    planesCompletados: 0,
                    planesEnProceso: 0,
                    planesPendientes: 0
                };
            });
            
            // Analizar cada plan
            plans.forEach(plan => {
                if (plan.elaboracion.estado && plan.elaboracion.eje) {
                    const ejeId = plan.elaboracion.eje;
                    
                    if (ejeUsage[ejeId]) {
                        // Incrementar contador de planes
                        ejeUsage[ejeId].totalPlanes++;
                        
                        // Agregar usuario (elaborador)
                        ejeUsage[ejeId].usuarios.add(plan.elaborado);
                        
                        // Agregar indicador si existe
                        if (plan.elaboracion.indicador) {
                            ejeUsage[ejeId].indicadoresUtilizados.add(plan.elaboracion.indicador);
                            
                            // Contar uso de indicadores
                            const indicadorKey = plan.elaboracion.indicador;
                            const descripcion = plan.elaboracion.descripcionIndicador || "Sin descripción";
                            
                            if (!indicadoresUsage[indicadorKey]) {
                                indicadoresUsage[indicadorKey] = {
                                    indicador: indicadorKey,
                                    descripcion: descripcion,
                                    ejeId: ejeId,
                                    vecesUtilizado: 0
                                };
                            }
                            indicadoresUsage[indicadorKey].vecesUtilizado++;
                        }
                        
                        // Contar planes por estado
                        if (plan.estado === "completado") {
                            ejeUsage[ejeId].planesCompletados++;
                        } else if (plan.estado === "en proceso") {
                            ejeUsage[ejeId].planesEnProceso++;
                        } else {
                            ejeUsage[ejeId].planesPendientes++;
                        }
                    }
                }
            });
            
            return { ejeUsage, indicadoresUsage };
        }

        // Función para actualizar las estadísticas en el dashboard
        function updateDashboardStats() {
            const { ejeUsage, indicadoresUsage } = calculateEjeUsage();
            
            // Actualizar tarjetas de estadísticas
            totalPlanes.textContent = plans.length;
            usuariosActivos.textContent = users.length;
            
            // Contar planes completados
            const completados = plans.filter(p => p.estado === "completado").length;
            planesCompletados.textContent = completados;
            
            // Contar ejes utilizados
            const ejesUsados = Object.values(ejeUsage).filter(eje => eje.totalPlanes > 0).length;
            ejesUtilizados.textContent = ejesUsados;
            
            // Calcular porcentajes de cambio (simulado)
            const planesChange = plans.length > 1 ? Math.round((plans.length / 1) * 100) - 100 : 0;
            document.getElementById('planesChange').innerHTML = `<i class="fas fa-arrow-${planesChange >= 0 ? 'up' : 'down'}"></i> <span>${Math.abs(planesChange)}%</span> desde el mes pasado`;
            
            const usuariosChange = users.length > 1 ? Math.round((users.length / 1) * 100) - 100 : 0;
            document.getElementById('usuariosChange').innerHTML = `<i class="fas fa-arrow-${usuariosChange >= 0 ? 'up' : 'down'}"></i> <span>${Math.abs(usuariosChange)}%</span> desde el mes pasado`;
            
            const completadosChange = completados > 0 ? 100 : 0;
            document.getElementById('completadosChange').innerHTML = `<i class="fas fa-arrow-${completadosChange >= 0 ? 'up' : 'down'}"></i> <span>${Math.abs(completadosChange)}%</span> desde el mes pasado`;
            
            const ejesChange = ejesUsados > 0 ? 100 : 0;
            document.getElementById('ejesChange').innerHTML = `<i class="fas fa-arrow-${ejesChange >= 0 ? 'up' : 'down'}"></i> <span>${Math.abs(ejesChange)}%</span> desde el mes pasado`;
            
            // Actualizar tabla de estadísticas de ejes
            updateEjeStatsTable(ejeUsage);
            
            // Actualizar tabla de indicadores
            updateIndicadoresTable(indicadoresUsage, ejeUsage);
            
            // Actualizar gráficos
            updateBarChart(ejeUsage);
            updateLineChartProgreso(ejeUsage);
            
            // Actualizar análisis detallado
            updateAnalisisDetallado(ejeUsage);
        }

        // Función para actualizar la tabla de estadísticas de ejes
        function updateEjeStatsTable(ejeUsage) {
            statsTableBody.innerHTML = '';
            
            let totalPlanesConElaboracion = 0;
            Object.values(ejeUsage).forEach(eje => {
                totalPlanesConElaboracion += eje.totalPlanes;
            });
            
            // Filtrar según el filtro activo
            let ejesFiltrados = Object.values(ejeUsage);
            if (currentDashboardFilter !== 'all') {
                if (currentDashboardFilter.startsWith('eje')) {
                    const ejeNum = parseInt(currentDashboardFilter.replace('eje', ''));
                    ejesFiltrados = ejesFiltrados.filter(eje => {
                        const ejeIndex = ejes.findIndex(e => e.id === ejeNum);
                        return ejeIndex !== -1 && ejes[ejeIndex].nombre === eje.nombre;
                    });
                }
            }
            
            // Ordenar por número de planes (descendente)
            ejesFiltrados.sort((a, b) => b.totalPlanes - a.totalPlanes);
            
            if (ejesFiltrados.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-chart-bar" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>No hay datos disponibles para mostrar</p>
                    </td>
                `;
                statsTableBody.appendChild(row);
                return;
            }
            
            ejesFiltrados.forEach(eje => {
                const porcentajeUso = totalPlanesConElaboracion > 0 ? 
                    Math.round((eje.totalPlanes / totalPlanesConElaboracion) * 100) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${eje.nombre}</strong></td>
                    <td>${eje.indicadoresDisponibles} indicadores</td>
                    <td>${eje.usuarios.size}</td>
                    <td>${eje.totalPlanes}</td>
                    <td>
                        <span class="percentage-badge">${porcentajeUso}%</span>
                        <div class="simple-bar">
                            <div class="simple-bar-fill" style="width: ${porcentajeUso}%"></div>
                        </div>
                    </td>
                    <td>${eje.indicadoresUtilizados.size}</td>
                `;
                
                // Resaltar la fila si tiene muchos planes
                if (eje.totalPlanes >= 3) {
                    row.classList.add('highlight');
                }
                
                statsTableBody.appendChild(row);
            });
        }

        // Función para actualizar la tabla de indicadores
        function updateIndicadoresTable(indicadoresUsage, ejeUsage) {
            indicadoresTableBody.innerHTML = '';
            
            // Convertir a array y ordenar por veces utilizado
            const indicadoresArray = Object.values(indicadoresUsage);
            indicadoresArray.sort((a, b) => b.vecesUtilizado - a.vecesUtilizado);
            
            if (indicadoresArray.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>No hay indicadores registrados</p>
                    </td>
                `;
                indicadoresTableBody.appendChild(row);
                return;
            }
            
            // Calcular total de usos para porcentajes
            const totalUsos = indicadoresArray.reduce((sum, ind) => sum + ind.vecesUtilizado, 0);
            
            indicadoresArray.forEach(ind => {
                const ejeNombre = ejeUsage[ind.ejeId] ? ejeUsage[ind.ejeId].nombre : 'No asignado';
                const porcentajeUso = totalUsos > 0 ? Math.round((ind.vecesUtilizado / totalUsos) * 100) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${ind.indicador}</strong></td>
                    <td>${ejeNombre}</td>
                    <td>${ind.descripcion}</td>
                    <td>
                        <span style="font-weight: 600; color: var(--primary);">${ind.vecesUtilizado}</span>
                        <div class="simple-bar">
                            <div class="simple-bar-fill" style="width: ${(ind.vecesUtilizado / (indicadoresArray[0]?.vecesUtilizado || 1)) * 100}%"></div>
                        </div>
                    </td>
                    <td>
                        <span class="percentage-badge">${porcentajeUso}%</span>
                    </td>
                `;
                
                // Resaltar si es muy utilizado
                if (ind.vecesUtilizado >= 3) {
                    row.classList.add('highlight');
                }
                
                indicadoresTableBody.appendChild(row);
            });
        }
        
        // ==================== GRÁFICO DE BARRAS MEJORADO ====================
        
        // Función para actualizar el gráfico de barras
        function updateBarChart(ejeUsage) {
            // Si ya existe un gráfico, destruirlo
            if (barChart) {
                barChart.destroy();
            }
            
            // Obtener ejes filtrados
            let ejesFiltrados = Object.values(ejeUsage);
            if (currentDashboardFilter !== 'all') {
                if (currentDashboardFilter.startsWith('eje')) {
                    const ejeNum = parseInt(currentDashboardFilter.replace('eje', ''));
                    ejesFiltrados = ejesFiltrados.filter(eje => {
                        const ejeIndex = ejes.findIndex(e => e.id === ejeNum);
                        return ejeIndex !== -1 && ejes[ejeIndex].nombre === eje.nombre;
                    });
                }
            }
            
            if (ejesFiltrados.length === 0) {
                // Crear gráfico vacío
                const ctx = barChartCanvas.getContext('2d');
                barChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Sin datos'],
                        datasets: [{
                            label: 'Planes',
                            data: [0],
                            backgroundColor: 'rgba(149, 165, 166, 0.6)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'No hay datos disponibles'
                            }
                        }
                    }
                });
                return;
            }
            
            // Preparar datos para el gráfico de barras
            const labels = ejesFiltrados.map(eje => eje.nombre);
            const data = ejesFiltrados.map(eje => eje.totalPlanes);
            
            // Colores para cada barra
            const backgroundColors = [
                'rgba(52, 152, 219, 0.8)', // Azul
                'rgba(46, 204, 113, 0.8)', // Verde
                'rgba(231, 76, 60, 0.8)',  // Rojo
                'rgba(243, 156, 18, 0.8)', // Naranja
                'rgba(155, 89, 182, 0.8)', // Morado
                'rgba(26, 188, 156, 0.8)', // Turquesa
                'rgba(241, 196, 15, 0.8)', // Amarillo
                'rgba(230, 126, 34, 0.8)', // Naranja oscuro
            ];
            
            // Crear el gráfico de barras
            const ctx = barChartCanvas.getContext('2d');
            barChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Planes por Eje',
                        data: data,
                        backgroundColor: backgroundColors.slice(0, labels.length),
                        borderColor: backgroundColors.map(color => color.replace('0.8', '1')).slice(0, labels.length),
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Número de Planes',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Ejes',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const eje = ejesFiltrados[context.dataIndex];
                                    const planesCompletados = eje.planesCompletados || 0;
                                    const planesEnProceso = eje.planesEnProceso || 0;
                                    const planesPendientes = eje.planesPendientes || 0;
                                    
                                    return [
                                        `Total: ${context.parsed.y} planes`,
                                        `Completados: ${planesCompletados}`,
                                        `En proceso: ${planesEnProceso}`,
                                        `Pendientes: ${planesPendientes}`
                                    ];
                                }
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // ==================== GRÁFICO DE LÍNEAS PARA PROGRESO ====================
        
        // Función para actualizar el gráfico de líneas de progreso
        function updateLineChartProgreso(ejeUsage) {
            // Si ya existe un gráfico, destruirlo
            if (lineChart) {
                lineChart.destroy();
            }
            
            // Obtener ejes filtrados
            let ejesFiltrados = Object.values(ejeUsage);
            if (currentDashboardFilter !== 'all') {
                if (currentDashboardFilter.startsWith('eje')) {
                    const ejeNum = parseInt(currentDashboardFilter.replace('eje', ''));
                    ejesFiltrados = ejesFiltrados.filter(eje => {
                        const ejeIndex = ejes.findIndex(e => e.id === ejeNum);
                        return ejeIndex !== -1 && ejes[ejeIndex].nombre === eje.nombre;
                    });
                }
            }
            
            if (ejesFiltrados.length === 0) {
                // Crear gráfico vacío
                const ctx = lineChartCanvas.getContext('2d');
                lineChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Sin datos'],
                        datasets: [{
                            label: 'Progreso',
                            data: [0],
                            borderColor: 'rgba(149, 165, 166, 0.6)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'No hay datos disponibles'
                            }
                        }
                    }
                });
                return;
            }
            
            // Preparar datos para el gráfico de líneas
            const meses = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            const datasets = [];
            
            // Colores para cada línea
            const lineColors = [
                'rgba(52, 152, 219, 1)',    // Azul
                'rgba(46, 204, 113, 1)',    // Verde
                'rgba(231, 76, 60, 1)',     // Rojo
                'rgba(243, 156, 18, 1)',    // Naranja
                'rgba(155, 89, 182, 1)',    // Morado
                'rgba(26, 188, 156, 1)',    // Turquesa
                'rgba(241, 196, 15, 1)',    // Amarillo
                'rgba(230, 126, 34, 1)',    // Naranja oscuro
            ];
            
            // Para cada eje, generar datos de progreso mensual
            ejesFiltrados.forEach((eje, index) => {
                // Generar datos acumulativos para el progreso
                const baseValue = eje.totalPlanes;
                let acumulado = 0;
                const data = meses.map(() => {
                    // Incremento aleatorio pero con tendencia creciente
                    const incremento = Math.floor(Math.random() * 3);
                    acumulado += incremento;
                    return Math.min(acumulado, baseValue);
                });
                
                datasets.push({
                    label: eje.nombre,
                    data: data,
                    borderColor: lineColors[index % lineColors.length],
                    backgroundColor: lineColors[index % lineColors.length].replace('1)', '0.1)'),
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointHoverRadius: 8,
                    pointBackgroundColor: lineColors[index % lineColors.length],
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2
                });
            });
            
            // Crear el gráfico de líneas
            const ctx = lineChartCanvas.getContext('2d');
            lineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Planes Acumulados',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Meses del Año',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 11
                                },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1,
                            padding: 12
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // ==================== ANÁLISIS DETALLADO ====================
        
        // Función para actualizar el análisis detallado
        function updateAnalisisDetallado(ejeUsage) {
            // Actualizar estado de planes por eje
            estadoEjesList.innerHTML = '';
            
            Object.values(ejeUsage).forEach(eje => {
                if (eje.totalPlanes > 0) {
                    const li = document.createElement('li');
                    li.className = 'analisis-item';
                    li.innerHTML = `
                        <span class="analisis-label">${eje.nombre}</span>
                        <span class="analisis-value">${eje.totalPlanes} planes</span>
                        <span class="analisis-badge ${eje.planesCompletados >= eje.planesPendientes ? 'badge-success' : 'badge-warning'}">
                            ${Math.round((eje.planesCompletados / eje.totalPlanes) * 100) || 0}% completados
                        </span>
                    `;
                    estadoEjesList.appendChild(li);
                }
            });
            
            if (estadoEjesList.children.length === 0) {
                estadoEjesList.innerHTML = '<li class="analisis-item"><span class="analisis-label">No hay datos disponibles</span></li>';
            }
            
            // Actualizar eficiencia por responsable
            eficienciaResponsablesList.innerHTML = '';
            
            const responsableStats = {};
            
            // Calcular estadísticas por responsable
            plans.forEach(plan => {
                if (plan.elaboracion.responsable) {
                    const responsableId = plan.elaboracion.responsable;
                    const responsableNombre = responsables.find(r => r.id == responsableId)?.nombre || 'Desconocido';
                    
                    if (!responsableStats[responsableNombre]) {
                        responsableStats[responsableNombre] = {
                            planes: 0,
                            completados: 0
                        };
                    }
                    
                    responsableStats[responsableNombre].planes++;
                    if (plan.estado === "completado") {
                        responsableStats[responsableNombre].completados++;
                    }
                }
            });
            
            // Convertir a array y ordenar por eficiencia
            const responsablesArray = Object.entries(responsableStats).map(([nombre, stats]) => ({
                nombre,
                ...stats,
                eficiencia: stats.planes > 0 ? Math.round((stats.completados / stats.planes) * 100) : 0
            }));
            
            responsablesArray.sort((a, b) => b.eficiencia - a.eficiencia);
            
            responsablesArray.forEach(responsable => {
                const li = document.createElement('li');
                li.className = 'analisis-item';
                li.innerHTML = `
                    <span class="analisis-label">${responsable.nombre}</span>
                    <span class="analisis-value">${responsable.eficiencia}%</span>
                    <span class="analisis-badge ${responsable.eficiencia >= 70 ? 'badge-success' : responsable.eficiencia >= 40 ? 'badge-warning' : 'badge-danger'}">
                        ${responsable.completados}/${responsable.planes}
                    </span>
                `;
                eficienciaResponsablesList.appendChild(li);
            });
            
            if (eficienciaResponsablesList.children.length === 0) {
                eficienciaResponsablesList.innerHTML = '<li class="analisis-item"><span class="analisis-label">No hay datos disponibles</span></li>';
            }
            
            // Actualizar distribución de planes
            distribucionPlanesList.innerHTML = '';
            
            const totalPlanesCount = plans.length;
            const completadosCount = plans.filter(p => p.estado === "completado").length;
            const enProcesoCount = plans.filter(p => p.estado === "en proceso").length;
            const pendientesCount = plans.filter(p => p.estado === "pendiente").length;
            
            const distribuciones = [
                { label: 'Completados', valor: completadosCount, porcentaje: totalPlanesCount > 0 ? Math.round((completadosCount / totalPlanesCount) * 100) : 0, clase: 'badge-success' },
                { label: 'En Proceso', valor: enProcesoCount, porcentaje: totalPlanesCount > 0 ? Math.round((enProcesoCount / totalPlanesCount) * 100) : 0, clase: 'badge-warning' },
                { label: 'Pendientes', valor: pendientesCount, porcentaje: totalPlanesCount > 0 ? Math.round((pendientesCount / totalPlanesCount) * 100) : 0, clase: 'badge-danger' }
            ];
            
            distribuciones.forEach(dist => {
                const li = document.createElement('li');
                li.className = 'analisis-item';
                li.innerHTML = `
                    <span class="analisis-label">${dist.label}</span>
                    <span class="analisis-value">${dist.porcentaje}%</span>
                    <span class="analisis-badge ${dist.clase}">${dist.valor} planes</span>
                `;
                distribucionPlanesList.appendChild(li);
            });
        }
        
        // ==================== FILTROS DEL DASHBOARD ====================
        
        // Event listeners para los botones de filtro
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remover clase active de todos los botones
                filterBtns.forEach(b => b.classList.remove('active'));
                
                // Agregar clase active al botón clickeado
                this.classList.add('active');
                
                // Actualizar filtro actual
                currentDashboardFilter = this.getAttribute('data-filter');
                
                // Recargar estadísticas con el filtro aplicado
                updateDashboardStats();
            });
        });
        
        // ==================== FUNCIONES PARA SUBIDA DE ARCHIVOS ====================
        
        // File upload functionality
        selectFilesBtn.addEventListener('click', function() {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });
        
        // Drag and drop functionality
        fileUploadContainer.addEventListener('dragover', function(e) {
            e.preventDefault();
            fileUploadContainer.classList.add('dragover');
        });
        
        fileUploadContainer.addEventListener('dragleave', function() {
            fileUploadContainer.classList.remove('dragover');
        });
        
        fileUploadContainer.addEventListener('drop', function(e) {
            e.preventDefault();
            fileUploadContainer.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        
        function handleFiles(files) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file.type === 'application/pdf') {
                    // Simulate file upload (in a real app, you would upload to a server)
                    const fileObj = {
                        id: Date.now() + i,
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        uploadDate: new Date().toLocaleDateString()
                    };
                    
                    currentEjecucionFiles.push(fileObj);
                    displayUploadedFile(fileObj);
                } else {
                    showAlert('warning', `El archivo ${file.name} no es un PDF válido`);
                }
            }
        }
        
        function displayUploadedFile(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <div class="file-name">
                    <i class="fas fa-file-pdf file-icon"></i>
                    <span>${file.name} (${formatFileSize(file.size)})</span>
                </div>
                <div class="file-actions">
                    <button class="btn btn-danger btn-xs delete-file" data-id="${file.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            uploadedFiles.appendChild(fileItem);
            
            // Add event listener to delete button
            fileItem.querySelector('.delete-file').addEventListener('click', function() {
                const fileId = parseInt(this.getAttribute('data-id'));
                deleteFile(fileId);
                fileItem.remove();
            });
        }
        
        function deleteFile(fileId) {
            currentEjecucionFiles = currentEjecucionFiles.filter(file => file.id !== fileId);
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // ==================== EVENT LISTENERS PARA BOTONES Y BÚSQUEDA ====================
        
        // Configurar eventos de búsqueda
        searchUsers.addEventListener('input', debounce(() => {
            loadUsers(1, searchUsers.value);
        }, 300));
        
        searchPlans.addEventListener('input', debounce(() => {
            loadPlans(1, searchPlans.value);
        }, 300));
        
        searchTemas.addEventListener('input', debounce(() => {
            loadTemas(1, searchTemas.value);
        }, 300));
        
        searchEjes.addEventListener('input', debounce(() => {
            loadEjes(1, searchEjes.value);
        }, 300));
        
        searchIndicadores.addEventListener('input', debounce(() => {
            loadIndicadoresPage(1, searchIndicadores.value);
        }, 300));
        
        searchPlazos.addEventListener('input', debounce(() => {
            loadPlazos(1, searchPlazos.value);
        }, 300));
        
        searchResponsables.addEventListener('input', debounce(() => {
            loadResponsables(1, searchResponsables.value);
        }, 300));
        
        // Configurar eventos para cambiar registros por página
        usersPerPage.addEventListener('change', () => {
            loadUsers(1, currentUsersSearch);
        });
        
        plansPerPage.addEventListener('change', () => {
            loadPlans(1, currentPlansSearch);
        });
        
        temasPerPage.addEventListener('change', () => {
            loadTemas(1, currentTemasSearch);
        });
        
        ejesPerPage.addEventListener('change', () => {
            loadEjes(1, currentEjesSearch);
        });
        
        indicadoresPerPage.addEventListener('change', () => {
            loadIndicadoresPage(1, currentIndicadoresSearch);
        });
        
        plazosPerPage.addEventListener('change', () => {
            loadPlazos(1, currentPlazosSearch);
        });
        
        responsablesPerPage.addEventListener('change', () => {
            loadResponsables(1, currentResponsablesSearch);
        });
        
        // Función debounce para búsqueda
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Add User functionality
        addUserBtn.addEventListener('click', function() {
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            openModal(addUserModal);
        });
        
        saveUserBtn.addEventListener('click', function() {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            
            if (username && password) {
                const newUser = {
                    id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
                    username: username,
                    password: password
                };
                
                users.push(newUser);
                loadUsers(1, currentUsersSearch);
                closeModal(addUserModal);
                showAlert('success', 'Usuario creado exitosamente');
                
                // Actualizar dashboard si está activo
                if (document.getElementById('dashboard').style.display === 'block') {
                    updateDashboardStats();
                }
            } else {
                showAlert('warning', 'Por favor complete todos los campos');
            }
        });
        
        // Add Plan functionality
        addPlanBtn.addEventListener('click', function() {
            document.getElementById('elaboradoName').value = '';
            document.getElementById('responsableName').value = '';
            openModal(addPlanModal);
        });
        
        savePlanBtn.addEventListener('click', function() {
            const elaborado = document.getElementById('elaboradoName').value;
            const responsable = document.getElementById('responsableName').value;
            
            if (elaborado && responsable) {
                const newPlan = {
                    id: plans.length > 0 ? Math.max(...plans.map(p => p.id)) + 1 : 1,
                    elaborado: elaborado,
                    responsable: responsable,
                    estado: "pendiente",
                    elaboracion: { 
                        estado: false, 
                        contenido: "",
                        tema: "",
                        objetivo: "",
                        eje: "",
                        item: "ITEM DESCRIPCIÓN",
                        indicador: "",
                        descripcionIndicador: "",
                        lineaBase: "",
                        politicas: "",
                        metas: "",
                        actividades: "",
                        indicadorResultado: "",
                        medioVerificacion: [],
                        responsable: "",
                        fecha: ""
                    },
                    seguimiento: { 
                        estado: false, 
                        contenido: "",
                        cumplimiento: [],
                        fecha: ""
                    },
                    ejecucion: { 
                        estado: false, 
                        contenido: "", 
                        archivos: [],
                        fecha: ""
                    }
                };
                
                plans.push(newPlan);
                loadPlans(1, currentPlansSearch);
                closeModal(addPlanModal);
                showAlert('success', 'Plan creado exitosamente');
                
                // Actualizar dashboard si está activo
                if (document.getElementById('dashboard').style.display === 'block') {
                    updateDashboardStats();
                }
            } else {
                showAlert('warning', 'Por favor complete todos los campos');
            }
        });
        
        // Add Tema functionality
        addTemaBtn.addEventListener('click', function() {
            document.getElementById('temaName').value = '';
            openModal(addTemaModal);
        });
        
        saveTemaBtn.addEventListener('click', function() {
            const nombre = document.getElementById('temaName').value;
            
            if (nombre) {
                const newTema = {
                    id: temas.length > 0 ? Math.max(...temas.map(t => t.id)) + 1 : 1,
                    nombre: nombre
                };
                
                temas.push(newTema);
                loadTemas(1, currentTemasSearch);
                closeModal(addTemaModal);
                showAlert('success', 'Tema creado exitosamente');
            } else {
                showAlert('warning', 'Por favor ingrese el nombre del tema');
            }
        });
        
        // Add Eje functionality
        addEjeBtn.addEventListener('click', function() {
            document.getElementById('ejeName').value = '';
            document.getElementById('objetivoDesc').value = '';
            openModal(addEjeModal);
        });
        
        saveEjeBtn.addEventListener('click', function() {
            const nombre = document.getElementById('ejeName').value;
            const objetivo = document.getElementById('objetivoDesc').value;
            
            if (nombre && objetivo) {
                const newEje = {
                    id: ejes.length > 0 ? Math.max(...ejes.map(e => e.id)) + 1 : 1,
                    nombre: nombre,
                    objetivo: objetivo,
                    indicadores: []
                };
                
                ejes.push(newEje);
                loadEjes(1, currentEjesSearch);
                closeModal(addEjeModal);
                showAlert('success', 'Eje y Objetivo creado exitosamente');
                
                // Actualizar dashboard si está activo
                if (document.getElementById('dashboard').style.display === 'block') {
                    updateDashboardStats();
                }
            } else {
                showAlert('warning', 'Por favor complete todos los campos');
            }
        });
        
        // Edit Eje functionality
        updateEjeBtn.addEventListener('click', function() {
            const ejeId = parseInt(editEjeModal.getAttribute('data-eje-id'));
            const nombre = document.getElementById('editEjeName').value;
            const objetivo = document.getElementById('editObjetivoDesc').value;
            
            if (nombre && objetivo) {
                const ejeIndex = ejes.findIndex(e => e.id === ejeId);
                if (ejeIndex !== -1) {
                    ejes[ejeIndex].nombre = nombre;
                    ejes[ejeIndex].objetivo = objetivo;
                    loadEjes(currentEjesPage, currentEjesSearch);
                    closeModal(editEjeModal);
                    showAlert('success', 'Eje y Objetivo actualizado exitosamente');
                    
                    // Actualizar dashboard si está activo
                    if (document.getElementById('dashboard').style.display === 'block') {
                        updateDashboardStats();
                    }
                }
            } else {
                showAlert('warning', 'Por favor complete todos los campos');
            }
        });
        
        // Add Plazo functionality
        addPlazoBtn.addEventListener('click', function() {
            document.getElementById('plazoName').value = '';
            openModal(addPlazoModal);
        });
        
        savePlazoBtn.addEventListener('click', function() {
            const nombre = document.getElementById('plazoName').value;
            
            if (nombre) {
                const newPlazo = {
                    id: plazos.length > 0 ? Math.max(...plazos.map(p => p.id)) + 1 : 1,
                    nombre: nombre
                };
                
                plazos.push(newPlazo);
                loadPlazos(1, currentPlazosSearch);
                closeModal(addPlazoModal);
                showAlert('success', 'Plazo creado exitosamente');
            } else {
                showAlert('warning', 'Por favor ingrese el nombre del plazo');
            }
        });
        
        // Edit Plazo functionality
        updatePlazoBtn.addEventListener('click', function() {
            const plazoId = parseInt(editPlazoModal.getAttribute('data-plazo-id'));
            const nombre = document.getElementById('editPlazoName').value;
            
            if (nombre) {
                const plazoIndex = plazos.findIndex(p => p.id === plazoId);
                if (plazoIndex !== -1) {
                    plazos[plazoIndex].nombre = nombre;
                    loadPlazos(currentPlazosPage, currentPlazosSearch);
                    closeModal(editPlazoModal);
                    showAlert('success', 'Plazo actualizado exitosamente');
                }
            } else {
                showAlert('warning', 'Por favor ingrese el nombre del plazo');
            }
        });
        
        // Add Responsable functionality
        addResponsableBtn.addEventListener('click', function() {
            document.getElementById('responsableNombre').value = '';
            openModal(addResponsableModal);
        });
        
        saveResponsableBtn.addEventListener('click', function() {
            const nombre = document.getElementById('responsableNombre').value;
            
            if (nombre) {
                const newResponsable = {
                    id: responsables.length > 0 ? Math.max(...responsables.map(r => r.id)) + 1 : 1,
                    nombre: nombre
                };
                
                responsables.push(newResponsable);
                loadResponsables(1, currentResponsablesSearch);
                closeModal(addResponsableModal);
                showAlert('success', 'Responsable creado exitosamente');
            } else {
                showAlert('warning', 'Por favor ingrese el nombre del responsable');
            }
        });
        
        // Edit Responsable functionality
        updateResponsableBtn.addEventListener('click', function() {
            const responsableId = parseInt(editResponsableModal.getAttribute('data-responsable-id'));
            const nombre = document.getElementById('editResponsableNombre').value;
            
            if (nombre) {
                const responsableIndex = responsables.findIndex(r => r.id === responsableId);
                if (responsableIndex !== -1) {
                    responsables[responsableIndex].nombre = nombre;
                    loadResponsables(currentResponsablesPage, currentResponsablesSearch);
                    closeModal(editResponsableModal);
                    showAlert('success', 'Responsable actualizado exitosamente');
                }
            } else {
                showAlert('warning', 'Por favor ingrese el nombre del responsable');
            }
        });
        
        // ==================== EVENT LISTENERS PARA BOTONES DE IMPRESIÓN/PDF ====================
        
        // Botón para generar PDF
        generarPDFBtn.addEventListener('click', generarPDF);
        
        // Botón para imprimir
        imprimirBtn.addEventListener('click', imprimirDocumento);
        
        // Botón para vista previa
        vistaPreviaBtn.addEventListener('click', function() {
            if (!currentPlanId) return;
            
            const plan = plans.find(p => p.id === currentPlanId);
            if (!plan) return;
            
            showAlert('info', 'Mostrando vista previa completa');
            // La vista previa ya está visible en el contenedor
        });
        
        // ==================== INICIALIZACIÓN ====================
        
        // Initialize the application
        loadUsers();
        loadPlans();
        loadTemas();
        loadEjes();
        loadPlazos();
        loadResponsables();
        // Cargar indicadores inicialmente
        loadIndicadoresPage();
        
        // Event listener para el botón de login
        loginBtn.addEventListener('click', handleLogin);
        
        // Allow Enter key to submit login form
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleLogin();
            }
        });
        
        // Adjust layout on window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth > 992) {
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
            }
        });
        
        // Mostrar credenciales por defecto en la consola para facilitar el acceso
        console.log('Credenciales por defecto:');
        console.log('Usuario: admin');
        console.log('Contraseña: admin123');
        console.log('El sistema ahora incluye:');
        console.log('1. Paginación en todos los CRUDs (10 registros por página)');
        console.log('2. Búsqueda en tiempo real en todos los módulos');
        console.log('3. Tarjetas del dashboard con tamaño ajustado');
        console.log('4. Gráficos mejorados con datos separados por eje');
        console.log('5. Funcionalidad completa de PDF usando jsPDF');
        console.log('6. Imprimir directamente desde el navegador');
        console.log('7. Análisis detallado de estadísticas');
    </script>
</body>
</html>